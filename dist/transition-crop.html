<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    *{ margin: 0; padding:0; }
    /* 显示隐藏动画实现 */
    .crop-wrap {
      transform: translate3d(100%, 0, 0);
      -webkit-transform: translate3d(100%, 0, 0);
    }
    .crop-wrap.show {
      transition: .3s transform;
      transform: translate3d(0, 0, 0);
      -webkit-transform: translate3d(0, 0, 0);
    }
    .crop-wrap.hide {
      transition: .3s transform;
      transform: translate3d(100%, 0, 0);
      -webkit-transform: translate3d(100%, 0, 0);
    }
  </style>
</head>
<body>
  <br />
  <br />
  <input type="file" id="file-input" accept="image/*">
  <button onclick="window.crop && window.crop.destroy();window.crop=null;">销毁组件</button>
  <script src="crop.js"></script>
  <script>
    var options = {
      width: 300,
      height: 300,
      mounted: function () {
        // 事件监听
        ;['dragstart', 'dragmove', 'dragend', 'pinchstart', 'pinchmove', 'pinchend'].forEach(function (eventName) {
          crop.pinch.on(eventName, function (e) {
            console.log(eventName)
          })
        })
      },
      loaded: function () {
        this.show()
      },
      cancle: function () {
        this.hide()
      },
      confirm: function () {
        createImage(this.get({width: 600, format: 'url'}).url, 300)
        createImage(this.get({width: 300, format: 'url'}).url, 150)
        createImage(this.get({width: 150, format: 'url'}).url, 75)
        this.hide()
      }
    }
    window.crop = new Crop(options)

    document.getElementById('file-input').onchange = onChange

    function onChange (e) {
      var file = e.target.files[0]
      if (!file) return false
      window.crop.load(file)
      this.value = ''
    }

    function createImage (src, width) {
      var img = new window.Image()
      img.src = src
      img.style.width = width + 'px'
      document.body.appendChild(img)
    }

    // 如果显示/隐藏的时候需要过渡动画，则重写组件的显示、隐藏方法，默认的方法没有过渡动画，只是改变了display属性
    // 通过改变class实现动画
    Crop.prototype.show = function () {
      const that = this
      setTimeout(function () {
        const el = that.root.el
        el.style.display = 'block'
        setTimeout(function() {
          el.className = 'crop-wrap show'
        }, 20)
      })
    }

    Crop.prototype.hide = function () {
      const that = this
      setTimeout(function() {
        const el = that.root.el
        el.className = 'crop-wrap hide'
        setTimeout(function() {
          el.style.display = 'none'
        }, 300)
      })
    }
  </script>
</html>
