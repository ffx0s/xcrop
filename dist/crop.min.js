/*!
     * @name xcrop v1.1.13
     * @github https://github.com/ffx0s/xcrop
     * @license MIT.
     */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Crop=e()}(this,function(){"use strict";var d=window,b=d.Math;function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function e(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function t(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function r(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}!function(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&i.firstChild?i.insertBefore(o,i.firstChild):i.appendChild(o),o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t))}}('.crop{position:fixed;left:0;top:0;overflow:hidden;background:#000;z-index:99;-ms-touch-action:none;touch-action:none;-webkit-transition:transform .3s;transition:transform .3s;-webkit-transition:-webkit-transform .3s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.crop_hide{display:none}.crop_slide-to-left{-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}.crop_slide-to-right{-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0)}.crop_slide-to-top{-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}.crop_slide-to-bottom{-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0)}.crop__zoom{position:absolute;z-index:2;width:100%;height:100%;left:0;top:0}.crop__mask{position:absolute;overflow:hidden;border:1px solid rgba(0,0,0,.6);-webkit-box-sizing:content-box;box-sizing:content-box;z-index:1}.crop__mask:before{top:0;content:"";height:100%;border:1px solid #fff;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:inherit}.crop__handle,.crop__mask:before{position:absolute;left:0;width:100%}.crop__handle{bottom:0;height:50px;line-height:50px;-webkit-transform:translateZ(0);transform:translateZ(0);z-index:3}.crop__handle div{height:100%;width:80px;color:#fff;font-size:16px;text-align:center}.crop__handle-cancle{float:left}.crop__handle-confirm{float:right}');var s=Object.prototype.toString,c=Array.prototype.slice;function l(){}function u(t){return"[object Object]"===s.call(t)}function f(t){return"number"==typeof t&&t!==1/0&&!isNaN(t)}function h(a){return function(n){if(null!=n){for(var i=arguments,t=i.length,e=function(t){var e=i[t];if(null==e)return!1;Object.keys(e).forEach(function(t){a(n,e,t)})},o=1;o<t;o++)e(o);return n}}}var m=h(function(t,e,n){var i=e[n];!function(t){return u(t)||Array.isArray(t)}(i)?t[n]=i:(t[n]=u(i)?{}:[],m(t[n],i))}),p=Object.assign||h(function(t,e,n){var i=e[n];t[n]=i});var v,g,y=(v=navigator.userAgent,g=!!v.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),{android:(v.match(/Android\s([0-9\\.]*)/)||[])[1]||!1,ios:g&&{version:+v.match(/[OS\s]\d+/i)[0]}});function w(t){return c.call(t)}function x(n){var i=!1;return function(){var t=this;if(!i){var e=arguments;d.requestAnimationFrame(function(){n.apply(t,e),i=!1}),i=!0}}}function k(t){return document.body.contains(t)}function C(t,e){for(var n in e){var i=f(e[n])?e[n]+"px":e[n];-1!==["transform","transformOrigin","transition"].indexOf(n)?t.style["Webkit"+((o=n).charAt(0).toUpperCase()+o.slice(1))]=t.style[n]=i:t.style[n]=i}var o}var A=/\S+/g,_=function(t,e){var n=t.className;e.remove&&(n=function(e,t){return(Array.isArray(t)?t:t.match(A)).forEach(function(t){e=e.replace(new RegExp("".concat(t),"g"),"")}),e.trim()}(n,e.remove)),e.add&&(n=function(t,e){return e=Array.isArray(e)?e.join(" "):e.match(A).join(" "),""===t?e:t+" "+e}(n,e.add)),t.className=n},E=function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){return E=function(){return!0},t=!0}});d.addEventListener("testPassive",null,e),d.removeEventListener("testPassive",null,e)}catch(t){E=function(){return!1}}return t};function R(t,e,n,i){var o=3<arguments.length&&void 0!==i?i:{capture:!1};t.addEventListener(e,n,E()?p({capture:!1,passive:!0,once:!1},o):o.capture)}function O(t,e,n,i){var o=3<arguments.length&&void 0!==i?i:{capture:!1};t.removeEventListener(e,n,o.capture)}function S(t,e){return t+e}function T(t){return{x:t.map(function(t){return t.x}).reduce(S)/t.length,y:t.map(function(t){return t.y}).reduce(S)/t.length}}function B(t,e,n){var i=e[(n=n||["x","y"])[0]]-t[n[0]],o=e[n[1]]-t[n[1]];return b.sqrt(i*i+o*o)}function D(t,e,n){var i=e.x-t.x,o=e.y-t.y,a=1-n/t.scale;return{x:t.x+i*a,y:t.y+o*a,scale:n}}function L(t){return t.touches?t.touches:[t]}function H(t){t.canvas=function(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n.style.cssText="width:100%;height:100%;",n}(t.options.width,t.options.height),t.context=t.canvas.getContext("2d"),t.renderAction=function(){t.bindEvent(),t.render(),t.renderAction=l}}var I={bindEvent:function(){var e=this,n=e.options.touchTarget||e.canvas;e.eventList.forEach(function(t){R(n,t,e[t]=e[t].bind(e),{passive:!1})})},removeEvent:function(){var e=this,n=e.options.touchTarget||e.canvas;e.eventList.forEach(function(t){n.removeEventListener(t,e[t])})},mousewheel:function(t){t.preventDefault();var e=t.deltaY,n=b.pow(.99,e);this.mousescroll(t,n)},mousescroll:function(t,e){var n=this,i=n.options,o=i.maxScale,a=i.minScale,r=n.position.scale*e;n.rect||(n.rect=n.canvas.getBoundingClientRect()),n.last.point={x:(t.clientX-n.rect.left)*n.canvasRatio,y:(t.clientY-n.rect.top)*n.canvasRatio},o<r?r=o:r<a&&(r=a),n.position.scale!==r&&n.scaleTo(n.last.point,r),clearTimeout(n.mouseScrollTimer),n.mouseScrollTimer=setTimeout(function(){n.validation(null,!0)},100),n.emit("mousewheel",t)},mousedown:function(t){t.preventDefault();this.touchstart(t),function(n,i,t){var o=2<arguments.length&&void 0!==t&&t;R(document,"mousemove",n,{passive:!1,capture:o}),R(document,"mouseup",function t(e){i(e),O(document,"mousemove",n,{capture:o}),O(document,"mouseup",t,{capture:o})},{capture:o})}(this.touchmove,this.touchend)},touchstart:function(t){t.preventDefault();var e=L(t);this.moved=!1,this.animation.stop(),2===e.length?this.pinchstart(t):1===e.length&&this.dragstart(t)},touchmove:function(t){t.preventDefault();var e=L(t);this.moved=!0,2===e.length?this.pinchmove(t):1===e.length&&this.dragmove(t)},touchend:function(t){var e=this,n=t.touches||[],i=Date.now();if(!e.moved){i-e.upTime<=300&&e.dobuleClick()}e.upTime=i,n.length?(e.emit("pinchend",t),e.dragstart(t)):e.dragend(t)},dragstart:function(t){var e=this,n=L(t);e.last.move={x:n[0].clientX,y:n[0].clientY},e.last.dis={time:0,x:0,y:0},e.last.time=Date.now(),e.touchDelay=3,e.emit("dragstart",t)},dragmove:function(t){var e=this,n=L(t),i={x:n[0].clientX,y:n[0].clientY},o=(i.x-e.last.move.x)*e.canvasRatio,a=(i.y-e.last.move.y)*e.canvasRatio,r=Date.now();e.last.dis={x:o,y:a,time:r-e.last.time},e.last.time=r,e.last.move=i,e.touchDelay?e.touchDelay--:(e.moveTo(e.position.x+o,e.position.y+a),e.emit("dragmove",t))},dragend:function(t){var e=this;if(e.moved){var n=e.position,i=n.scale,o=function(t,e,n){var i=t/n,o=e/n;if(.3<b.abs(i)||.3<b.abs(o))return{x:i*=420,y:o*=420,time:840}}(e.last.dis.x,e.last.dis.y,e.last.dis.time);if(o){var a=n.x+o.x,r=n.y+o.y,s="easeOutCubic",c=e.validation({x:a,y:r,scale:i});c.isDraw&&(a=c.x,r=c.y,i=c.scale,s="easeOutBack"),e.animate(a,r,i,{type:s,time:o.time})}else e.validation(null,!0);e.emit("dragend",t)}},pinchstart:function(t){var e=this,n=w(L(t)).map(function(t){return{x:t.clientX,y:t.clientY}}),i=T(n);e.rect=e.canvas.getBoundingClientRect(),e.last.zoom=n,e.last.point={x:(i.x-e.rect.left)*e.canvasRatio,y:(i.y-e.rect.top)*e.canvasRatio},e.touchDelay=5,e.emit("pinchstart",t)},pinchmove:function(t){var e=this,n=w(L(t)).map(function(t){return{x:t.clientX,y:t.clientY}}),i=T(n),o={x:(i.x-e.rect.left)*e.canvasRatio,y:(i.y-e.rect.top)*e.canvasRatio},a=o.x-e.last.point.x,r=o.y-e.last.point.y,s=function(t,e){return B(e[0],e[1])/B(t[0],t[1])}(e.last.zoom,n);e.last.zoom=n,e.last.point=o,e.touchDelay?e.touchDelay--:(e.position.x+=a,e.position.y+=r,e.scaleTo(o,e.position.scale*s),e.emit("pinchmove",t))},dobuleClick:function(){var t=this,e=t.canvas.getBoundingClientRect(),n=t.options,i=n.maxScale,o=n.minScale,a={x:(t.last.move.x-e.left)*t.canvasRatio,y:(t.last.move.y-e.top)*t.canvasRatio},r=t.position.scale;t.scaleTo(a,r<i?i:o,!0,!0)}},U={easeOutStrong:function(t,e,n,i){return-n*((t=t/i-1)*t*t*t-1)+e},easeOutCubic:function(t,e,n,i){return n*((t=t/i-1)*t*t+1)+e},easeOutBack:function(t,e,n,i,o){return void 0===o&&(o=1.70158),n*((t=t/i-1)*t*((o+1)*t+o)+1)+e}};!function(){for(var o=0,t=["ms","moz","webkit","o"],e=0;e<t.length&&!d.requestAnimationFrame;++e)d.requestAnimationFrame=d[t[e]+"RequestAnimationFrame"],d.cancelAnimationFrame=d[t[e]+"CancelAnimationFrame"]||d[t[e]+"CancelRequestAnimationFrame"];d.requestAnimationFrame||(d.requestAnimationFrame=function(t){var e=Date.now(),n=b.max(0,16-(e-o)),i=d.setTimeout(function(){t(e+n)},n);return o=e+n,i}),d.cancelAnimationFrame||(d.cancelAnimationFrame=function(t){clearTimeout(t)})}();function j(){return Date.now()}var F={time:500,type:"easeOutQuad"};var q=d.URL&&d.URL.createObjectURL?d.URL:d.webkitURL&&d.webkitURL.createObjectURL?d.webkitURL:null;function P(t){var e;e=0<=t.split(",")[0].indexOf("base64")?d.atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var n,i=t.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(e.length),a=new Uint8Array(o),r=0;r<e.length;r++)a[r]=e.charCodeAt(r);try{n=new d.Blob([o],{type:i})}catch(t){if(d.BlobBuilder=d.BlobBuilder||d.WebKitBlobBuilder||d.MozBlobBuilder||d.MSBlobBuilder,"TypeError"===t.name&&d.BlobBuilder){var s=new d.BlobBuilder;s.append(a.buffer),n=s.getBlob(i)}else"InvalidStateError"===t.name&&(n=new d.Blob([o],{type:i}))}return n}function z(t,e,n){var i=new d.XMLHttpRequest;i.onload=function(){200===this.status||0===this.status?e(i.response):n&&n("Could not load image："+t),i=null},i.open("GET",t,!0),i.responseType="arraybuffer",i.send(null)}function W(t,e,n){var i=new d.FileReader;i.onload=function(t){e(t.target.result)},i.onerror=n||function(t){console.error("fileToArrayBuffer error: ",t)},i.readAsArrayBuffer(t)}function N(t,e,n,i){var o=t.naturalWidth,a=t.naturalHeight;if(o+a){var r=n.width,s=n.height,c=e.getContext("2d");c.save(),function(t){var e=t.naturalWidth,n=t.naturalHeight;{if(1048576<e*n){var i=document.createElement("canvas");i.width=i.height=1;var o=i.getContext("2d");return o.drawImage(t,1-e,0),0===o.getImageData(0,0,1,1).data[3]}return!1}}(t)&&(o/=2,a/=2);var l=1024,u=document.createElement("canvas");u.width=u.height=l;for(var f=u.getContext("2d"),d=i?function(t,e,n){var i=document.createElement("canvas");i.width=1,i.height=n;var o=i.getContext("2d");o.drawImage(t,0,0);var a=o.getImageData(0,0,1,n).data,r=0,s=n,c=n;for(;r<c;){0===a[4*(c-1)+3]?s=c:r=c,c=s+r>>1}var l=c/n;return 0==l?1:l}(t,0,a):1,h=b.ceil(l*r/o),m=b.ceil(l*s/a/d),v=0,p=0;v<a;){for(var g=0,y=0;g<o;)f.clearRect(0,0,l,l),f.drawImage(t,-g,-v),c.drawImage(u,0,0,l,l,y,p,h,m),g+=l,y+=h;v+=l,p+=m}c.restore(),u=f=null}}function M(t,e,n){var i=new d.Image;return function(t){return 0<t.indexOf(";base64,")}(t)||(i.crossOrigin="*"),i.onload=function(){e(i)},i.onerror=n||function(t){console.error("loadImage error: ",t)},i.src=t,i}var X={url:{getArrayBuffer:z,toImage:M},file:{getArrayBuffer:W,toImage:function(t,e,n){M(q.createObjectURL(t),e,n)}},objectURL:{getArrayBuffer:function(t,e,n){!function(t,e){var n=new d.XMLHttpRequest;n.open("GET",t,!0),n.responseType="blob",n.onload=function(t){200!==this.status&&0!==this.status||e(this.response)},n.send()}(t,function(t){W(t,e,n)})},toImage:M},base64:{getArrayBuffer:function(t,e,n){W(P(t),e,n)},toImage:M},imageEl:{getArrayBuffer:function(t,e,n){z(t.src,e,n)},toImage:function(t,e){e(t)}}},Y=y.ios?{8:4e6,9:16777216}:null;function G(i,u,t){var f=m({orientation:!0,errorCallback:l},t),e="";if(d.FileReader&&(i instanceof d.Blob||i instanceof d.File))e="file";else if(function(t){return/^blob:/i.test(t)}(i))e="objectURL";else if(i&&i.tagName&&i.nodeType){if("IMG"===i.tagName&&(e="imageEl"),"CANVAS"===i.tagName)return void u(i)}else e="url";function o(t,e,n){var i=document.createElement("canvas"),o=e.width,a=e.height,r=i.getContext("2d");function s(t,e){f.orientation?function(t,e,n,i,o){switch(-1<[5,6,7,8].indexOf(o)?(t.width=i,t.height=n):(t.width=n,t.height=i),o){case 2:e.transform(-1,0,0,1,n,0);break;case 3:e.transform(-1,0,0,-1,n,i);break;case 4:e.transform(1,0,0,-1,0,i);break;case 5:e.transform(0,1,1,0,0,0);break;case 6:e.transform(0,1,-1,0,i,0);break;case 7:e.transform(0,-1,-1,0,i,n);break;case 8:e.transform(0,-1,1,0,0,n);break;default:e.transform(1,0,0,1,0,0)}}(i,r,t,e,n):(i.width=t,i.height=e)}if(Y&&Y[y.ios.version]&&o*a>Y[y.ios.version]){var c=b.sqrt(Y[y.ios.version]),l=function(t,e){var n=e.maxWidth,i=e.maxHeight,o=e.width,a=e.height,r=t.naturalWidth,s=t.naturalHeight;o&&!a?a=s*o/r<<0:a&&!o?o=r*a/s<<0:(o=r,a=s);n&&n<r&&(a=s*(o=n)/r<<0);i&&i<a&&(o=r*(a=i)/s<<0);return{width:o,height:a}}(e,p({},f,{maxWidth:c,maxHeight:c}));s(l.width,l.height),N(e,i,l,!0)}else s(o,a),r.drawImage(e,0,0);u(i)}X[e].toImage(i,function(n){f.orientation?X[e].getArrayBuffer(i,function(t){var e=function(t){var e=new DataView(t);if(65496!==e.getUint16(0,!1))return-2;for(var n=e.byteLength,i=2;i<n;){var o=e.getUint16(i,!1);if(i+=2,65505===o){if(1165519206!==e.getUint32(i+=2,!1))return-1;var a=18761===e.getUint16(i+=6,!1);i+=e.getUint32(i+4,a);var r=e.getUint16(i,a);i+=2;for(var s=0;s<r;s++)if(274===e.getUint16(i+12*s,a))return e.getUint16(i+12*s+8,a)}else{if(65280!=(65280&o))break;i+=e.getUint16(i,!1)}}return-1}(t);o(i,n,e)},f.errorCallback):o(i,n)},f.errorCallback)}function V(t,e){var n=function(t){var e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),e}(t),i=n.getContext("2d"),o=document.createElement("canvas"),a=o.getContext("2d"),r=n.width,s=n.height,c=b.ceil(r*e),l=b.ceil(s*e);o.width=c,o.height=l;for(var u=b.ceil(b.log(r/c)/b.log(3)),f=0;f<u;f++)i.drawImage(n,0,0,.5*r,.5*s);return a.drawImage(n,0,0,n.width*b.pow(.5,u),n.height*b.pow(.5,u),0,0,c,l),n=i=null,o}var Z={load:function(t,e){var n=this;G(t,function(t){n.initImageData(t),n.draw(),n.renderAction(),function(t,e){setTimeout(t,e||0)}(function(){e&&e(),n.emit("loaded",n)})},{errorCallback:function(t){n.emit("error",t)}})},initImageData:function(t){var e=this,n=e.options,i=n.width,o=n.height,a=n.offset,r=n.maxScale,s={el:t,width:t.width,height:t.height},c=i-(a.left+a.right),l=o-(a.top+a.bottom),u=function(t,e,n,i){var o=t/e,a=n,r=a/o,s=0,c=-(r-i)/2;return r<i&&(s=-((a=o*(r=i))-n)/2,c=0),{width:a,height:r,x:s,y:c,scale:+(a/t).toFixed(4)}}(s.width,s.height,c,l);u.x+=a.left,u.y+=a.top;var f=b.max(u.scale,r),d=u.scale;e.options.maxScale=f===d?u.scale*b.max(r,1):r,e.options.minScale=d,e.position=u,e.image=s},destroy:function(){this.removeEvent(),k(this.canvas)&&this.options.el.removeChild(this.canvas)},draw:function(){var t=this,e=t.context,n=t.options,i=n.width,o=n.height,a=t.position,r=a.x,s=a.y,c=a.scale;!function(t,e,n,i){y.android&&parseFloat(y.android)<=4.1?t.height=i:e.clearRect(0,0,n,i)}(t.canvas,e,i,o),e.save(),e.translate(r,s),e.scale(c,c),e.drawImage(t.image.el,0,0),e.restore()},setData:function(t){var e,n,i={x:1,y:1,scale:4};for(var o in t)this.position[o]=(e=t[o],n=i[o],+e.toFixed(n))},moveTo:function(t,e,n){n?this.animate(t,e,this.position.scale):(this.setData({x:t,y:e}),this.draw())},scaleTo:function(t,e,n,i){var o=this;if(e!==o.position.scale){var a=D(o.position,t,e),r=a.x,s=a.y;if(i){var c=o.checkPosition({x:r,y:s,scale:e});r=c.x,s=c.y}n?o.animate(r,s,e):(o.setData({scale:e}),o.moveTo(r,s))}},animate:function(t,e,n,i){var o=3<arguments.length&&void 0!==i?i:{time:450,type:"easeOutCubic"},a=this;a.animation.stop(),a.animation=function(t){var o=null,e=m({},F,t),a=e.time,r=e.type,s=e.targets,c=e.running,l=e.end,u=j();return o=d.requestAnimationFrame(function t(){var e=j(),n=1-(b.max(0,u-e+a)/a||0),i=[];s.forEach(function(t){var e=t[0]===t[1]?t[0]:U[r](n*a,t[0],t[1]-t[0],a)||0;i.push(e)}),c(i),1==n?(d.cancelAnimationFrame(o),l&&l()):o=d.requestAnimationFrame(t)}),{stop:function(){d.cancelAnimationFrame(o)}}}({targets:[[a.position.scale,n],[a.position.x,t],[a.position.y,e]],time:o.time,type:o.type,running:function(t){a.setData({scale:t[0],x:t[1],y:t[2]}),a.draw()}})}},K={validation:function(o,t){var a=this;o=o||a.position;function e(t){var e=D(o,a.last.point,t),n=e.x,i=e.y;(c=a.checkPosition({x:n,y:i,scale:t})).scale=t,c.isDraw=!0}var n=a.options,i=n.maxScale,r=n.minScale,s=o.scale,c={x:o.x,y:o.y,isDraw:!1};return i<s?e(i):s<r?e(r):(c=a.checkPosition(o)).scale=s,t&&c.isDraw&&a.animate(c.x,c.y,c.scale),c},checkPosition:function(t){var e=t.x,n=t.y,i=t.scale,o=this.options,a=o.width,r=o.height,s=o.offset,c=i*this.image.width,l=i*this.image.height,u=a-(s.left+s.right)-(c-(s.left-e)),f=r-(s.top+s.bottom)-(l-(s.top-n)),d=!1;return n>s.top?(n=s.top,d=!0):0<f&&(n+=f,d=!0),e>s.left?(e=s.left,d=!0):0<u&&(e+=u,d=!0),{x:e,y:n,isDraw:d}}},Q=Array.prototype.slice,J=function(){function t(){o(this,t),this.events={}}return e(t,[{key:"on",value:function(t,e,n){var i=this;return t.split(" ").forEach(function(t){i.events[t]||(i.events[t]=[]),e&&i.events[t].push({fn:e,once:n})}),i}},{key:"emit",value:function(t){var o=this,a=Q.call(arguments,1);t=t.split(" ").forEach(function(t){var e=o.events[t];if(e)for(var n=e.length,i=0;i<n;i++){e[i]&&(e[i].fn.apply(o,a),e[i].once&&e.splice(i--,1))}})}},{key:"off",value:function(t,e){var n=this.events[t];if(n){if(!e)return void(this.events[t]=[]);for(var i=n.length,o=0;o<i;o++)if(n[o]&&n[o].fn===e){n.splice(o,1);break}}else t||(this.events={})}}]),t}(),$=function(){function i(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};o(this,i);var n=r(t=function(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?r(t):e}(this,a(i).call(this)));return e.el&&(e.el=function(t){return function(t){return"string"==typeof t}(t)?document.querySelector(t):t}(e.el)),n.options=m({},i.defaults,e),n.init(),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}(i,J),e(i,[{key:"init",value:function(){H(this),function(t){t.eventList=["mousewheel","mousedown","touchstart","touchmove","touchend"],t.last={point:{x:0,y:0},move:{x:0,y:0},time:0,dis:{time:0,x:0,y:0}},t.touchDelay=3,t.animation={stop:l},t.wheeling=!1,t.upTime=0,t.touchmove=x(t.touchmove),t.mousescroll=x(t.mousescroll)}(this),function(t){t.position={x:0,y:0,width:0,height:0,scale:1},t.image={width:0,height:0,el:null}}(this)}}]),i}();t($,"defaults",{el:document.body,width:2*document.documentElement.clientWidth,height:2*document.documentElement.clientHeight,maxScale:2,touchTarget:null,offset:{left:0,right:0,top:0,bottom:0}}),p($.prototype,{render:function(){var t=this,e=t.options,n=e.el,i=e.canvasRatio,o=e.width;n.appendChild(t.canvas),t.rect=t.canvas.getBoundingClientRect(),t.canvasRatio=i||o/t.rect.width}},I,Z,K);var tt=document.documentElement.clientWidth,et=document.documentElement.clientHeight,nt=.9*b.min(tt,et),it=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};o(this,a);var e=this;e.options=m({},a.defaults,t),e.border=e.options.border,e.elements={},e.isHide=!0,e.init()}return e(a,[{key:"init",value:function(){this.initElement(),this.initCanvas(),this.initEvent()}},{key:"initElement",value:function(){var n=this,t=n.options,e=t.viewWidth,i=t.viewHeight,o=document.createElement("div");o.innerHTML=function(t){var e=t.cancleText,n=t.confirmText;return'<div class="crop" data-el="container"><div class="crop__zoom" data-el="zoom"></div><div class="crop__mask" data-el="mask"></div><div class="crop__handle" data-el="handle">'+'<div class="crop__handle-cancle" data-el="cancle" data-click="onCancle">'.concat(e,"</div>")+'<div class="crop__handle-confirm" data-el="confirm" data-click="onConfirm">'.concat(n,"</div>")+"</div></div>"}(n.options),w(o.querySelectorAll("*")).forEach(function(t){var e=t.getAttribute("data-el");e&&(n.elements[e]=t)}),C(n.elements.container,{width:e,height:i}),_(n.elements.container,{add:a.CROP_HIDE_CLASS}),n.setBorder(n.border)}},{key:"initCanvas",value:function(){var t=this,e=t.options,n=e.canvasRatio,i=e.maxScale,o=e.viewWidth,a=e.viewHeight,r={maxScale:i,canvasRatio:n,el:t.elements.container,touchTarget:t.elements.zoom,width:o*n,height:a*n,offset:t.canvasOffset};t.canvas=new $(r)}},{key:"initEvent",value:function(){var t=this;t.onClick=t.onClick.bind(t),t.transitionend=t.transitionend.bind(t),t.canvas.on("loaded",t.render.bind(t),!0),t.canvas.on("loaded",t.show.bind(t)),R(t.elements.container,"click",t.onClick),R(t.elements.container,"transitionend",t.transitionend),R(t.elements.container,"webkitTransitionEnd",t.transitionend)}},{key:"load",value:function(t){this.canvas.load(t)}},{key:"onClick",value:function(t){var e=t.target.getAttribute("data-click");e&&this[e]&&this[e]()}},{key:"onCancle",value:function(){this.emit("cancle",this)}},{key:"onConfirm",value:function(){this.emit("confirm",this)}},{key:"transitionend",value:function(t){var e=t.target;e===this.elements.container&&this.isHide&&_(e,{add:a.CROP_HIDE_CLASS,remove:this.options.beforeHideClass})}},{key:"render",value:function(){this.options.el.appendChild(this.elements.container)}},{key:"get",value:function(t){function e(t,e){return function(t,e,n,i,o,a,r,s,c){var l=document.createElement("canvas"),u=l.width=b.floor(s),f=l.height=b.floor(c);return l.getContext("2d").drawImage(t,b.floor(e),b.floor(n),b.floor(i),b.floor(o),b.floor(a),b.floor(r),u,f),l}(i.canvas.image.el,f,d,l,u,0,0,t,e)}var n,i=this,o=i.options.canvasRatio,a=i.canvas.position,r=a.scale,s=a.x,c=a.y,l=i.border.width*o/r,u=i.border.height*o/r,f=(i.border.x*o-s)/r,d=(i.border.y*o-c)/r,h=(t=p({width:l,height:u,type:"image/jpeg",format:"base64",quality:.85},t||{})).width/l,m=3<=b.ceil(b.log(l/(l*h))/b.log(3));n=m?V(e(l,u),h):e(t.width,b.round(u*(t.width/l)));var v={base64:function(){return n.toDataURL(t.type,t.quality)},file:function(){return P(v.base64())},objectUrl:function(){return q.createObjectURL(v.file())},canvas:function(){return n}};if(v[t.format])return v[t.format]();throw new Error("Undefined format: ".concat(t.format,", Try: base64|file|objectUrl|canvas"))}},{key:"setBorder",value:function(t){var e=this,n=e.checkBorder(t),i=n.x,o=n.y,a=n.width,r=n.height,s=e.options,c=s.canvasRatio,l=s.viewWidth,u=s.viewHeight,f=s.circle,d={width:a,height:r,left:i-l,top:o-u,borderWidth:"".concat(u,"px ").concat(l,"px"),borderRadius:f?y.android&&parseFloat(y.android)<=4.1?null:"50%":null},h={left:i*c,top:o*c,right:(l-a-i)*c,bottom:(u-r-o)*c};e.canvas&&(e.canvas.options.offset=h),C(e.elements.mask,d),e.border=t,e.canvasOffset=h}},{key:"checkBorder",value:function(t){var e=t.x,n=t.y,i=t.width,o=t.height,a=this.options,r=a.viewWidth,s=a.viewHeight;return t.width=f(i)?i:r,t.height=f(o)?o:s,t.x=f(e)?e:(r-t.width)/2,t.y=f(n)?n:(s-t.height)/2,t}},{key:"on",value:function(){return this.canvas.on.apply(this.canvas,arguments)}},{key:"emit",value:function(){this.canvas.emit.apply(this.canvas,arguments)}},{key:"off",value:function(){this.canvas.off.apply(this.canvas,arguments)}},{key:"show",value:function(n){var i=this;i.isHide&&d.requestAnimationFrame(function(){var t=i.elements.container,e=i.options;!1===n?_(t,{remove:a.CROP_HIDE_CLASS}):(_(t,{remove:a.CROP_HIDE_CLASS,add:e.beforeShowClass}),d.requestAnimationFrame(function(){_(t,{remove:e.beforeShowClass})})),i.isHide=!1})}},{key:"hide",value:function(e){var n=this;n.isHide||d.requestAnimationFrame(function(){var t=n.elements.container;_(t,!1===e?{add:a.CROP_HIDE_CLASS}:{add:n.options.beforeHideClass}),n.isHide=!0})}},{key:"destroy",value:function(){var t=this,e=t.elements.container;t.canvas.destroy(),O(e,"click",t.onClick),O(e,"transitionend",t.transitionend),O(e,"webkitTransitionEnd",t.transitionend),k(e)&&t.options.el.removeChild(e)}}]),a}();return t(it,"defaults",{viewWidth:tt,viewHeight:et,el:document.body,border:{width:nt,height:nt},circle:!1,maxScale:2,canvasRatio:2,confirmText:"确认",cancleText:"取消",beforeShowClass:"crop_slide-to-right",beforeHideClass:"crop_slide-to-bottom"}),t(it,"imageToCanvas",G),t(it,"Canvas",$),t(it,"CROP_HIDE_CLASS","crop_hide"),it});
