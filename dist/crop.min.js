/*!
     * @name xcrop v1.1.16
     * @github https://github.com/ffx0s/xcrop
     * @license MIT.
     */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Crop=e()}(this,function(){"use strict";var f=window,x=f.Math;function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function e(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function t(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}!function(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===n&&i.firstChild?i.insertBefore(a,i.firstChild):i.appendChild(a),a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t))}}('.crop{position:fixed;left:0;top:0;overflow:hidden;background:#000;z-index:99;-ms-touch-action:none;touch-action:none;-webkit-transition:transform .3s;transition:transform .3s;-webkit-transition:-webkit-transform .3s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.crop_hide{display:none}.crop_slide-to-left{-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}.crop_slide-to-right{-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0)}.crop_slide-to-top{-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}.crop_slide-to-bottom{-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0)}.crop__zoom{position:absolute;z-index:2;width:100%;height:100%;left:0;top:0}.crop__mask{position:absolute;overflow:hidden;border:1px solid rgba(0,0,0,.6);-webkit-box-sizing:content-box;box-sizing:content-box;z-index:1}.crop__mask:before{top:0;content:"";height:100%;border:1px solid #fff;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:inherit}.crop__handle,.crop__mask:before{position:absolute;left:0;width:100%}.crop__handle{bottom:0;height:50px;line-height:50px;-webkit-transform:translateZ(0);transform:translateZ(0);z-index:3}.crop__handle div{height:100%;width:80px;color:#fff;font-size:16px;text-align:center}.crop__handle-cancle{float:left}.crop__handle-confirm{float:right}');var a=Object.prototype.toString,o=Array.prototype.slice;function h(){}function r(t){return"[object Object]"===a.call(t)}function u(t){return"number"==typeof t&&t!==1/0&&!isNaN(t)}function d(o){return function(n){if(null!=n){for(var i=arguments,t=i.length,e=function(t){var e=i[t];if(null==e)return!1;Object.keys(e).forEach(function(t){o(n,e,t)})},a=1;a<t;a++)e(a);return n}}}var m=d(function(t,e,n){var i,a=e[n];r(i=a)||Array.isArray(i)?(t[n]=r(a)?{}:[],m(t[n],a)):t[n]=a}),b=Object.assign||d(function(t,e,n){var i=e[n];t[n]=i});var v,p,g=(v=navigator.userAgent,p=!!v.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),{android:(v.match(/Android\s([0-9\\.]*)/)||[])[1]||!1,ios:p&&{version:+v.match(/[OS\s]\d+/i)[0]}});function y(t){return o.call(t)}function w(n){var i=!1;return function(){var t=this;if(!i){var e=arguments;f.requestAnimationFrame(function(){n.apply(t,e),i=!1}),i=!0}}}function k(t){return document.body.contains(t)}function C(t,e){for(var n in e){var i=u(e[n])?e[n]+"px":e[n];-1!==["transform","transformOrigin","transition"].indexOf(n)?t.style["Webkit"+((a=n).charAt(0).toUpperCase()+a.slice(1))]=t.style[n]=i:t.style[n]=i}var a}var A=/\S+/g,_=function(t,e){var n,i,a,o,r=t.className;e.remove&&(n=r,i=e.remove,(Array.isArray(i)?i:i.match(A)).forEach(function(t){n=n.replace(new RegExp("".concat(t),"g"),"")}),r=n.trim()),e.add&&(a=r,o=e.add,o=Array.isArray(o)?o.join(" "):o.match(A).join(" "),r=""===a?o:a+" "+o),t.className=r},E=function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){return E=function(){return!0},t=!0}});f.addEventListener("testPassive",null,e),f.removeEventListener("testPassive",null,e)}catch(t){E=function(){return!1}}return t};function R(t,e,n,i){var a=3<arguments.length&&void 0!==i?i:{capture:!1};t.addEventListener(e,n,E()?b({capture:!1,passive:!0,once:!1},a):a.capture)}function O(t,e,n,i){var a=3<arguments.length&&void 0!==i?i:{capture:!1};t.removeEventListener(e,n,a.capture)}function S(t,e){return t+e}function T(t){return{x:t.map(function(t){return t.x}).reduce(S)/t.length,y:t.map(function(t){return t.y}).reduce(S)/t.length}}function B(t,e,n){var i=e[(n=n||["x","y"])[0]]-t[n[0]],a=e[n[1]]-t[n[1]];return x.sqrt(i*i+a*a)}function D(t,e,n){var i=e.x-t.x,a=e.y-t.y,o=1-n/t.scale;return{x:t.x+i*o,y:t.y+a*o,scale:n}}function L(n,i,t){var a=2<arguments.length&&void 0!==t&&t;R(document,"mousemove",n,{passive:!1,capture:a}),R(document,"mouseup",function t(e){i(e),O(document,"mousemove",n,{capture:a}),O(document,"mouseup",t,{capture:a})},{capture:a})}function H(t){return t.touches?t.touches:[t]}function I(t){var e,n,i;t.canvas=(e=t.options.width,n=t.options.height,(i=document.createElement("canvas")).width=e,i.height=n,i.style.cssText="width:100%;height:100%;",i),t.context=t.canvas.getContext("2d"),t.renderAction=function(){t.bindEvent(),t.render(),t.renderAction=h}}var U={bindEvent:function(){var e=this,n=e.options.touchTarget||e.canvas;e.eventList.forEach(function(t){R(n,t,e[t]=e[t].bind(e),{passive:!1})})},removeEvent:function(){var e=this,n=e.options.touchTarget||e.canvas;e.eventList.forEach(function(t){n.removeEventListener(t,e[t])})},mousewheel:function(t){t.preventDefault();var e=t.deltaY,n=x.pow(.99,e);this.mousescroll(t,n)},mousescroll:function(t,e){var n=this,i=n.options,a=i.maxScale,o=i.minScale,r=n.position.scale*e;n.rect||(n.rect=n.canvas.getBoundingClientRect()),n.last.point={x:(t.clientX-n.rect.left)*n.canvasRatio,y:(t.clientY-n.rect.top)*n.canvasRatio},a<r?r=a:r<o&&(r=o),n.position.scale!==r&&n.scaleTo(n.last.point,r),clearTimeout(n.mouseScrollTimer),n.mouseScrollTimer=setTimeout(function(){n.validation(null,!0)},100),n.emit("mousewheel",t)},mousedown:function(t){t.preventDefault();this.touchstart(t),L(this.touchmove,this.touchend)},touchstart:function(t){t.preventDefault();var e=H(t);this.moved=!1,this.animation.stop(),2===e.length?this.pinchstart(t):1===e.length&&this.dragstart(t)},touchmove:function(t){t.preventDefault();var e=H(t);this.moved=!0,2===e.length?this.pinchmove(t):1===e.length&&this.dragmove(t)},touchend:function(t){var e=this,n=t.touches||[],i=Date.now();if(!e.moved){i-e.upTime<=300&&e.dobuleClick()}e.upTime=i,n.length?(e.emit("pinchend",t),e.dragstart(t)):e.dragend(t)},dragstart:function(t){var e=this,n=H(t);e.last.move={x:n[0].clientX,y:n[0].clientY},e.last.dis={time:0,x:0,y:0},e.last.time=Date.now(),e.touchDelay=3,e.emit("dragstart",t)},dragmove:function(t){var e=this,n=H(t),i={x:n[0].clientX,y:n[0].clientY},a=(i.x-e.last.move.x)*e.canvasRatio,o=(i.y-e.last.move.y)*e.canvasRatio,r=Date.now();e.last.dis={x:a,y:o,time:r-e.last.time},e.last.time=r,e.last.move=i,e.touchDelay?e.touchDelay--:(e.moveTo(e.position.x+a,e.position.y+o),e.emit("dragmove",t))},dragend:function(t){var e=this;if(e.moved){var n=e.position,i=n.scale,a=function(t,e,n){var i=t/n,a=e/n;if(.3<x.abs(i)||.3<x.abs(a))return{x:i*=420,y:a*=420,time:840}}(e.last.dis.x,e.last.dis.y,e.last.dis.time);if(a){var o=n.x+a.x,r=n.y+a.y,s="easeOutCubic",c=e.validation({x:o,y:r,scale:i});c.isDraw&&(o=c.x,r=c.y,i=c.scale,s="easeOutBack"),e.animate(o,r,i,{type:s,time:a.time})}else e.validation(null,!0);e.emit("dragend",t)}},pinchstart:function(t){var e=this,n=y(H(t)).map(function(t){return{x:t.clientX,y:t.clientY}}),i=T(n);e.rect=e.canvas.getBoundingClientRect(),e.last.zoom=n,e.last.point={x:(i.x-e.rect.left)*e.canvasRatio,y:(i.y-e.rect.top)*e.canvasRatio},e.touchDelay=5,e.emit("pinchstart",t)},pinchmove:function(t){var e,n,i=this,a=y(H(t)).map(function(t){return{x:t.clientX,y:t.clientY}}),o=T(a),r={x:(o.x-i.rect.left)*i.canvasRatio,y:(o.y-i.rect.top)*i.canvasRatio},s=r.x-i.last.point.x,c=r.y-i.last.point.y,l=(e=i.last.zoom,B((n=a)[0],n[1])/B(e[0],e[1]));i.last.zoom=a,i.last.point=r,i.touchDelay?i.touchDelay--:(i.position.x+=s,i.position.y+=c,i.scaleTo(r,i.position.scale*l),i.emit("pinchmove",t))},dobuleClick:function(){var t=this,e=t.canvas.getBoundingClientRect(),n=t.options,i=n.maxScale,a=n.minScale,o={x:(t.last.move.x-e.left)*t.canvasRatio,y:(t.last.move.y-e.top)*t.canvasRatio},r=t.position.scale;t.scaleTo(o,r<i?i:a,!0,!0)}},j={easeOutStrong:function(t,e,n,i){return-n*((t=t/i-1)*t*t*t-1)+e},easeOutCubic:function(t,e,n,i){return n*((t=t/i-1)*t*t+1)+e},easeOutBack:function(t,e,n,i,a){return void 0===a&&(a=1.70158),n*((t=t/i-1)*t*((a+1)*t+a)+1)+e}};!function(){for(var a=0,t=["ms","moz","webkit","o"],e=0;e<t.length&&!f.requestAnimationFrame;++e)f.requestAnimationFrame=f[t[e]+"RequestAnimationFrame"],f.cancelAnimationFrame=f[t[e]+"CancelAnimationFrame"]||f[t[e]+"CancelRequestAnimationFrame"];f.requestAnimationFrame||(f.requestAnimationFrame=function(t){var e=Date.now(),n=x.max(0,16-(e-a)),i=f.setTimeout(function(){t(e+n)},n);return a=e+n,i}),f.cancelAnimationFrame||(f.cancelAnimationFrame=function(t){clearTimeout(t)})}();function F(){return Date.now()}var q={time:500,type:"easeOutQuad"};function P(t){var a=null,e=m({},q,t),o=e.time,r=e.type,s=e.targets,c=e.running,l=e.end,u=F();return a=f.requestAnimationFrame(function t(){var e=F(),n=1-(x.max(0,u-e+o)/o||0),i=[];s.forEach(function(t){var e=t[0]===t[1]?t[0]:j[r](n*o,t[0],t[1]-t[0],o)||0;i.push(e)}),c(i),1==n?(f.cancelAnimationFrame(a),l&&l()):a=f.requestAnimationFrame(t)}),{stop:function(){f.cancelAnimationFrame(a)}}}var z=f.URL&&f.URL.createObjectURL?f.URL:f.webkitURL&&f.webkitURL.createObjectURL?f.webkitURL:null;function W(t){var e;e=0<=t.split(",")[0].indexOf("base64")?f.atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var n,i=t.split(",")[0].split(":")[1].split(";")[0],a=new ArrayBuffer(e.length),o=new Uint8Array(a),r=0;r<e.length;r++)o[r]=e.charCodeAt(r);try{n=new f.Blob([a],{type:i})}catch(t){if(f.BlobBuilder=f.BlobBuilder||f.WebKitBlobBuilder||f.MozBlobBuilder||f.MSBlobBuilder,"TypeError"===t.name&&f.BlobBuilder){var s=new f.BlobBuilder;s.append(o.buffer),n=s.getBlob(i)}else"InvalidStateError"===t.name&&(n=new f.Blob([a],{type:i}))}return n}function N(t,e,n){var i=new f.XMLHttpRequest;i.onload=function(){200===this.status||0===this.status?e(i.response):n&&n("Could not load image："+t),i=null},i.open("GET",t,!0),i.responseType="arraybuffer",i.send(null)}function M(t,e,n){var i=new f.FileReader;i.onload=function(t){e(t.target.result)},i.onerror=n||function(t){console.error("fileToArrayBuffer error: ",t)},i.readAsArrayBuffer(t)}function X(t,e,n,i){var a=t.naturalWidth,o=t.naturalHeight;if(a+o){var r=n.width,s=n.height,c=e.getContext("2d");c.save(),function(t){var e=t.naturalWidth,n=t.naturalHeight;{if(1048576<e*n){var i=document.createElement("canvas");i.width=i.height=1;var a=i.getContext("2d");return a.drawImage(t,1-e,0),0===a.getImageData(0,0,1,1).data[3]}return!1}}(t)&&(a/=2,o/=2);var l=1024,u=document.createElement("canvas");u.width=u.height=l;for(var d=u.getContext("2d"),f=i?function(t,e){var n=document.createElement("canvas");n.width=1,n.height=e;var i=n.getContext("2d");i.drawImage(t,0,0);var a=i.getImageData(0,0,1,e).data,o=0,r=e,s=e;for(;o<s;){0===a[4*(s-1)+3]?r=s:o=s,s=r+o>>1}var c=s/e;return 0==c?1:c}(t,o):1,h=x.ceil(l*r/a),m=x.ceil(l*s/o/f),v=0,p=0;v<o;){for(var g=0,y=0;g<a;)d.clearRect(0,0,l,l),d.drawImage(t,-g,-v),c.drawImage(u,0,0,l,l,y,p,h,m),g+=l,y+=h;v+=l,p+=m}c.restore(),u=d=null}}function Y(t,e,n){var i=new f.Image;return 0<t.indexOf(";base64,")||(i.crossOrigin="*"),i.onload=function(){e(i)},i.onerror=n||function(t){console.error("loadImage error: ",t)},i.src=t,i}var G={url:{getArrayBuffer:N,toImage:Y},file:{getArrayBuffer:M,toImage:function(t,e,n){Y(z.createObjectURL(t),e,n)}},objectURL:{getArrayBuffer:function(t,e,n){var i,a,o;i=t,a=function(t){M(t,e,n)},(o=new f.XMLHttpRequest).open("GET",i,!0),o.responseType="blob",o.onload=function(t){200!==this.status&&0!==this.status||a(this.response)},o.send()},toImage:Y},base64:{getArrayBuffer:function(t,e,n){M(W(t),e,n)},toImage:Y},imageEl:{getArrayBuffer:function(t,e,n){N(t.src,e,n)},toImage:function(t,e){e(t)}}},V=g.ios?{8:4e6,9:16777216}:null;function Z(t,u,e){var d=m({orientation:!0,errorCallback:h},e),i="";if(f.FileReader&&(t instanceof f.Blob||t instanceof f.File))i="file";else if(/^blob:/i.test(t))i="objectURL";else if(t&&t.tagName&&t.nodeType){if("IMG"===t.tagName&&(i="imageEl"),"CANVAS"===t.tagName)return void u(t)}else i="url";function a(t,e,n){var i=document.createElement("canvas"),a=e.width,o=e.height,r=i.getContext("2d");function s(t,e){d.orientation?function(t,e,n,i,a){switch(-1<[5,6,7,8].indexOf(a)?(t.width=i,t.height=n):(t.width=n,t.height=i),a){case 2:e.transform(-1,0,0,1,n,0);break;case 3:e.transform(-1,0,0,-1,n,i);break;case 4:e.transform(1,0,0,-1,0,i);break;case 5:e.transform(0,1,1,0,0,0);break;case 6:e.transform(0,1,-1,0,i,0);break;case 7:e.transform(0,-1,-1,0,i,n);break;case 8:e.transform(0,-1,1,0,0,n);break;default:e.transform(1,0,0,1,0,0)}}(i,r,t,e,n):(i.width=t,i.height=e)}if(V&&V[g.ios.version]&&a*o>V[g.ios.version]){var c=x.sqrt(V[g.ios.version]),l=function(t,e){var n=e.maxWidth,i=e.maxHeight,a=e.width,o=e.height,r=t.naturalWidth,s=t.naturalHeight;a&&!o?o=s*a/r<<0:o&&!a?a=r*o/s<<0:(a=r,o=s);n&&n<r&&(o=s*(a=n)/r<<0);i&&i<o&&(a=r*(o=i)/s<<0);return{width:a,height:o}}(e,b({},d,{maxWidth:c,maxHeight:c}));s(l.width,l.height),X(e,i,l,!0)}else s(a,o),r.drawImage(e,0,0);u(i)}G[i].toImage(t,function(n){d.orientation?G[i].getArrayBuffer(t,function(t){var e=function(t){var e=new DataView(t);if(65496!==e.getUint16(0,!1))return-2;for(var n=e.byteLength,i=2;i<n;){var a=e.getUint16(i,!1);if(i+=2,65505===a){if(1165519206!==e.getUint32(i+=2,!1))return-1;var o=18761===e.getUint16(i+=6,!1);i+=e.getUint32(i+4,o);var r=e.getUint16(i,o);i+=2;for(var s=0;s<r;s++)if(274===e.getUint16(i+12*s,o))return e.getUint16(i+12*s+8,o)}else{if(65280!=(65280&a))break;i+=e.getUint16(i,!1)}}return-1}(t);a(0,n,e)},d.errorCallback):a(0,n)},d.errorCallback)}function K(t,e){var n,i,a=(n=t,(i=document.createElement("canvas")).width=n.width,i.height=n.height,i.getContext("2d").drawImage(n,0,0),i),o=a.getContext("2d"),r=document.createElement("canvas"),s=r.getContext("2d"),c=a.width,l=a.height,u=x.ceil(c*e),d=x.ceil(l*e);r.width=u,r.height=d;for(var f=x.ceil(x.log(c/u)/x.log(3)),h=0;h<f;h++)o.drawImage(a,0,0,.5*c,.5*l);return s.drawImage(a,0,0,a.width*x.pow(.5,f),a.height*x.pow(.5,f),0,0,u,d),a=o=null,r}var Q={load:function(t,n){var i=this;Z(t,function(t){var e;i.initImageData(t),i.draw(),i.renderAction(),setTimeout(function(){n&&n(),i.emit("loaded",i)},e||0)},{errorCallback:function(t){i.emit("error",t)}})},initImageData:function(t){var e,n,i,a,o,r,s,c,l=this,u=l.options,d=u.width,f=u.height,h=u.offset,m=u.maxScale,v={el:t,width:t.width,height:t.height},p=d-(h.left+h.right),g=f-(h.top+h.bottom),y=(s=0,c=-((r=(o=n=p)/(a=(e=v.width)/v.height))-(i=g))/2,r<i&&(s=-((o=a*(r=i))-n)/2,c=0),{width:o,height:r,x:s,y:c,scale:+(o/e).toFixed(4)});y.x+=h.left,y.y+=h.top;var b=x.max(y.scale,m),w=y.scale;l.options.maxScale=b===w?y.scale*x.max(m,1):m,l.options.minScale=w,l.position=y,l.image=v},destroy:function(){this.removeEvent(),k(this.canvas)&&this.options.el.removeChild(this.canvas)},draw:function(){var t,e,n,i,a=this,o=a.context,r=a.options,s=r.width,c=r.height,l=a.position,u=l.x,d=l.y,f=l.scale;t=a.canvas,e=o,n=s,i=c,g.android&&parseFloat(g.android)<=4.1?t.height=i:e.clearRect(0,0,n,i),o.save(),o.translate(u,d),o.scale(f,f),o.drawImage(a.image.el,0,0),o.restore()},setData:function(t){var e,n,i={x:1,y:1,scale:4};for(var a in t)this.position[a]=(e=t[a],n=i[a],+e.toFixed(n))},moveTo:function(t,e,n){n?this.animate(t,e,this.position.scale):(this.setData({x:t,y:e}),this.draw())},scaleTo:function(t,e,n,i){var a=this;if(e!==a.position.scale){var o=D(a.position,t,e),r=o.x,s=o.y;if(i){var c=a.checkPosition({x:r,y:s,scale:e});r=c.x,s=c.y}n?a.animate(r,s,e):(a.setData({scale:e}),a.moveTo(r,s))}},animate:function(t,e,n,i){var a=3<arguments.length&&void 0!==i?i:{time:450,type:"easeOutCubic"},o=this;o.animation.stop(),o.animation=P({targets:[[o.position.scale,n],[o.position.x,t],[o.position.y,e]],time:a.time,type:a.type,running:function(t){o.setData({scale:t[0],x:t[1],y:t[2]}),o.draw()}})}},J={validation:function(a,t,e){var n=!(2<arguments.length&&void 0!==e)||e,o=this;a=a||o.position;function i(t){var e=D(a,o.last.point,t),n=e.x,i=e.y;(u=o.checkPosition({x:n,y:i,scale:t})).scale=t,u.isDraw=!0}var r=o.options,s=r.maxScale,c=r.minScale,l=a.scale,u={x:a.x,y:a.y,isDraw:!1};return s<l?i(s):l<c?i(c):(u=o.checkPosition(a)).scale=l,t&&u.isDraw&&(n?o.animate(u.x,u.y,u.scale):(o.setData({x:u.x,y:u.y,scale:u.scale}),o.draw())),u},checkPosition:function(t){var e=t.x,n=t.y,i=t.scale,a=this.options,o=a.width,r=a.height,s=a.offset,c=i*this.image.width,l=i*this.image.height,u=o-(s.left+s.right)-(c-(s.left-e)),d=r-(s.top+s.bottom)-(l-(s.top-n)),f=!1;return n>s.top?(n=s.top,f=!0):0<d&&(n+=d,f=!0),e>s.left?(e=s.left,f=!0):0<u&&(e+=u,f=!0),{x:e,y:n,isDraw:f}}},$=Array.prototype.slice,tt=function(){function t(){s(this,t),this.events={}}return e(t,[{key:"on",value:function(t,e,n){var i=this;return t.split(" ").forEach(function(t){i.events[t]||(i.events[t]=[]),e&&i.events[t].push({fn:e,once:n})}),i}},{key:"emit",value:function(t){var a=this,o=$.call(arguments,1);t=t.split(" ").forEach(function(t){var e=a.events[t];if(e)for(var n=e.length,i=0;i<n;i++){e[i]&&(e[i].fn.apply(a,o),e[i].once&&e.splice(i--,1))}})}},{key:"off",value:function(t,e){var n=this.events[t];if(n){if(!e)return void(this.events[t]=[]);for(var i=n.length,a=0;a<i;a++)if(n[a]&&n[a].fn===e){n.splice(a,1);break}}else t||(this.events={})}}]),t}(),et=function(){function r(){var t,e,n,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};s(this,r),e=this,t=!(n=c(r).call(this))||"object"!=typeof n&&"function"!=typeof n?l(e):n;var a,o=l(t);return i.el&&(i.el="string"==typeof(a=i.el)?document.querySelector(a):a),o.options=m({},r.defaults,i),o.init(),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}(r,tt),e(r,[{key:"init",value:function(){var t,e;I(this),(t=this).eventList=["mousewheel","mousedown","touchstart","touchmove","touchend"],t.last={point:{x:0,y:0},move:{x:0,y:0},time:0,dis:{time:0,x:0,y:0}},t.touchDelay=3,t.animation={stop:h},t.wheeling=!1,t.upTime=0,t.touchmove=w(t.touchmove),t.mousescroll=w(t.mousescroll),(e=this).position={x:0,y:0,width:0,height:0,scale:1},e.image={width:0,height:0,el:null}}}]),r}();t(et,"defaults",{el:document.body,width:2*document.documentElement.clientWidth,height:2*document.documentElement.clientHeight,maxScale:2,touchTarget:null,offset:{left:0,right:0,top:0,bottom:0}}),b(et.prototype,{render:function(){var t=this,e=t.options,n=e.el,i=e.canvasRatio,a=e.width;n.appendChild(t.canvas),t.rect=t.canvas.getBoundingClientRect(),t.canvasRatio=i||a/t.rect.width}},U,Q,J);var nt=document.documentElement.clientWidth,it=document.documentElement.clientHeight,at=.9*x.min(nt,it),ot=function(){function c(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};s(this,c);var e=this;e.options=m({},c.defaults,t),e.border=e.options.border,e.elements={},e.isHide=!0,e.init()}return e(c,[{key:"init",value:function(){this.initElement(),this.initCanvas(),this.initEvent()}},{key:"initElement",value:function(){var t,e,n,i=this,a=i.options,o=a.viewWidth,r=a.viewHeight,s=document.createElement("div");s.innerHTML=(t=i.options,e=t.cancleText,n=t.confirmText,'<div class="crop" data-el="container"><div class="crop__zoom" data-el="zoom"></div><div class="crop__mask" data-el="mask"></div><div class="crop__handle" data-el="handle">'+'<div class="crop__handle-cancle" data-el="cancle" data-click="onCancle">'.concat(e,"</div>")+'<div class="crop__handle-confirm" data-el="confirm" data-click="onConfirm">'.concat(n,"</div>")+"</div></div>"),y(s.querySelectorAll("*")).forEach(function(t){var e=t.getAttribute("data-el");e&&(i.elements[e]=t)}),C(i.elements.container,{width:o,height:r}),_(i.elements.container,{add:c.CROP_HIDE_CLASS}),i.setBorder(i.border)}},{key:"initCanvas",value:function(){var t=this,e=t.options,n=e.canvasRatio,i=e.maxScale,a=e.viewWidth,o=e.viewHeight,r={maxScale:i,canvasRatio:n,el:t.elements.container,touchTarget:t.elements.zoom,width:a*n,height:o*n,offset:t.canvasOffset};t.canvas=new et(r)}},{key:"initEvent",value:function(){var t=this;t.onClick=t.onClick.bind(t),t.transitionend=t.transitionend.bind(t),t.canvas.on("loaded",t.render.bind(t),!0),t.canvas.on("loaded",t.show.bind(t)),R(t.elements.container,"click",t.onClick),R(t.elements.container,"transitionend",t.transitionend),R(t.elements.container,"webkitTransitionEnd",t.transitionend)}},{key:"load",value:function(t){this.canvas.load(t)}},{key:"onClick",value:function(t){var e=t.target.getAttribute("data-click");e&&this[e]&&this[e]()}},{key:"onCancle",value:function(){this.emit("cancle",this)}},{key:"onConfirm",value:function(){this.emit("confirm",this)}},{key:"transitionend",value:function(t){var e=t.target;e===this.elements.container&&this.isHide&&_(e,{add:c.CROP_HIDE_CLASS,remove:this.options.beforeHideClass})}},{key:"render",value:function(){this.options.el.appendChild(this.elements.container)}},{key:"get",value:function(t){var m=this;m.canvas.validation(null,!0,!1);var e=m.options.canvasRatio,n=m.canvas.position,i=n.scale,a=n.x,o=n.y,v=m.border.width*e/i,p=m.border.height*e/i,g=(m.border.x*e-a)/i;g<0&&(g=0);var y=(m.border.y*e-o)/i;y<0&&(y=0);function r(t,e){return n=m.canvas.image.el,i=g,a=y,o=v,r=p,c=s=0,l=t,u=e,d=document.createElement("canvas"),f=d.width=x.floor(l),h=d.height=x.floor(u),d.getContext("2d").drawImage(n,x.floor(i),x.floor(a),x.floor(o),x.floor(r),x.floor(s),x.floor(c),f,h),d;var n,i,a,o,r,s,c,l,u,d,f,h}var s,c=(t=b({width:v,height:p,type:"image/jpeg",format:"base64",quality:.85},t||{})).width/v,l=3<=x.ceil(x.log(v/(v*c))/x.log(3));s=l?K(r(v,p),c):r(t.width,x.round(p*c));var u={base64:function(){return s.toDataURL(t.type,t.quality)},file:function(){return W(u.base64())},objectUrl:function(){return z.createObjectURL(u.file())},canvas:function(){return s}};if(u[t.format])return u[t.format]();throw new Error("Undefined format: ".concat(t.format,", Try: base64|file|objectUrl|canvas"))}},{key:"setBorder",value:function(t){var e=this,n=e.checkBorder(t),i=n.x,a=n.y,o=n.width,r=n.height,s=e.options,c=s.canvasRatio,l=s.viewWidth,u=s.viewHeight,d=s.circle,f={width:o,height:r,left:i-l,top:a-u,borderWidth:"".concat(u,"px ").concat(l,"px"),borderRadius:!d||g.android&&parseFloat(g.android)<=4.1?null:"50%"},h={left:i*c,top:a*c,right:(l-o-i)*c,bottom:(u-r-a)*c};e.canvas&&(e.canvas.options.offset=h),C(e.elements.mask,f),e.border=t,e.canvasOffset=h}},{key:"checkBorder",value:function(t){var e=t.x,n=t.y,i=t.width,a=t.height,o=this.options,r=o.viewWidth,s=o.viewHeight;return t.width=u(i)?i:r,t.height=u(a)?a:s,t.x=u(e)?e:(r-t.width)/2,t.y=u(n)?n:(s-t.height)/2,t}},{key:"on",value:function(){return this.canvas.on.apply(this.canvas,arguments)}},{key:"emit",value:function(){this.canvas.emit.apply(this.canvas,arguments)}},{key:"off",value:function(){this.canvas.off.apply(this.canvas,arguments)}},{key:"show",value:function(n){var i=this;i.isHide&&f.requestAnimationFrame(function(){var t=i.elements.container,e=i.options;!1===n?_(t,{remove:c.CROP_HIDE_CLASS}):(_(t,{remove:c.CROP_HIDE_CLASS,add:e.beforeShowClass}),f.requestAnimationFrame(function(){_(t,{remove:e.beforeShowClass})})),i.isHide=!1})}},{key:"hide",value:function(e){var n=this;n.isHide||f.requestAnimationFrame(function(){var t=n.elements.container;_(t,!1===e?{add:c.CROP_HIDE_CLASS}:{add:n.options.beforeHideClass}),n.isHide=!0})}},{key:"destroy",value:function(){var t=this,e=t.elements.container;t.canvas.destroy(),O(e,"click",t.onClick),O(e,"transitionend",t.transitionend),O(e,"webkitTransitionEnd",t.transitionend),k(e)&&t.options.el.removeChild(e)}}]),c}();return t(ot,"defaults",{viewWidth:nt,viewHeight:it,el:document.body,border:{width:at,height:at},circle:!1,maxScale:2,canvasRatio:2,confirmText:"确认",cancleText:"取消",beforeShowClass:"crop_slide-to-right",beforeHideClass:"crop_slide-to-bottom"}),t(ot,"imageToCanvas",Z),t(ot,"Canvas",et),t(ot,"CROP_HIDE_CLASS","crop_hide"),ot});
