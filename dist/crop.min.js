/*!
   * @name xcrop v1.1.6
   * @github https://github.com/ffx0s/xcrop
   * @license MIT.
   */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Crop=e()}(this,function(){"use strict";function t(t){return'<div class="crop-container" data-el="container"><div class="crop-zoom" data-el="zoom"></div><div class="crop-mask" data-el="mask"></div><div class="crop-handle" data-el="handle"><div class="crop-cancle" data-el="cancle" data-click="onCancle">'+t.cancleText+'</div><div class="crop-confirm" data-el="confirm" data-click="onConfirm">'+t.confirmText+"</div></div></div>"}function e(){}function n(t){return"[object Object]"===Y.call(t)}function i(t){return n(t)||Array.isArray(t)}function o(t){return"string"==typeof t}function a(t){return"number"==typeof t&&t!==1/0&&!isNaN(t)}function r(t){return function(e){if(null!==e&&void 0!==e){for(var n=arguments,i=n.length,o=1;o<i;o++)!function(i){var o=n[i];if(null===o||void 0===o)return!1;Object.keys(o).forEach(function(n){t(e,o,n)})}(o);return e}}}function s(t,e){setTimeout(t,e||0)}function c(t){return Z.call(t)}function l(t){return t.charAt(0).toUpperCase()+t.slice(1)}function u(t){var e=!1;return function(){var n=this;if(!e){var i=arguments;M.requestAnimationFrame(function(){t.apply(n,i),e=!1}),e=!0}}}function f(t){return o(t)?document.querySelector(t):t}function d(t){return document.body.contains(t)}function h(t,e){for(var n in e){var i=a(e[n])?e[n]+"px":e[n];-1!==["transform","transformOrigin","transition"].indexOf(n)?t.style["Webkit"+l(n)]=t.style[n]=i:t.style[n]=i}}function v(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{capture:!1},o={capture:!1,passive:!0,once:!1};t.addEventListener(e,n,$()?V(o,i):i.capture)}function m(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{capture:!1};t.removeEventListener(e,n,i.capture)}function p(t,e){return t+e}function g(t){return{x:t.map(function(t){return t.x}).reduce(p)/t.length,y:t.map(function(t){return t.y}).reduce(p)/t.length}}function y(t,e,n){n=n||["x","y"];var i=e[n[0]]-t[n[0]],o=e[n[1]]-t[n[1]];return X.sqrt(i*i+o*o)}function b(t,e){return y(e[0],e[1])/y(t[0],t[1])}function w(t,e,n){var i=e.x-t.x,o=e.y-t.y,a=1-n/t.scale;return{x:t.x+i*a,y:t.y+o*a,scale:n}}function x(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n.style.cssText="width:100%;height:100%;",n}function k(t,e){return+t.toFixed(e)}function C(t,e){function n(o){e(o),m(document,"mousemove",t,{capture:i}),m(document,"mouseup",n,{capture:i})}var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];v(document,"mousemove",t,{passive:!1,capture:i}),v(document,"mouseup",n,{capture:i})}function E(t){return t.touches?t.touches:[t]}function R(t){t.canvas=x(t.options.width,t.options.height),t.context=t.canvas.getContext("2d"),t.renderAction=function(){t.bindEvent(),t.render(),t.renderAction=e}}function T(t){t.eventList=["mousewheel","mousedown","touchstart","touchmove","touchend"],t.last={point:{x:0,y:0},move:{x:0,y:0},time:0,dis:{time:0,x:0,y:0}},t.touchDelay=3,t.animation={stop:e},t.wheeling=!1,t.upTime=0,t.dragmove=u(t.dragmove),t.pinchmove=u(t.pinchmove),t.mousescroll=u(t.mousescroll)}function A(t){var e=void 0;e=t.split(",")[0].indexOf("base64")>=0?M.atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var n=t.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(e.length),o=new Uint8Array(i),a=0;a<e.length;a++)o[a]=e.charCodeAt(a);var r=void 0;try{r=new M.Blob([i],{type:n})}catch(t){if(M.BlobBuilder=M.BlobBuilder||M.WebKitBlobBuilder||M.MozBlobBuilder||M.MSBlobBuilder,"TypeError"===t.name&&M.BlobBuilder){var s=new M.BlobBuilder;s.append(o.buffer),r=s.getBlob(n)}else"InvalidStateError"===t.name&&(r=new M.Blob([i],{type:n}))}return r}function B(t,e){var n=new M.XMLHttpRequest;n.open("GET",t,!0),n.responseType="blob",n.onload=function(t){200!==this.status&&0!==this.status||e(this.response)},n.send()}function S(t,e,n){var i=new M.XMLHttpRequest;i.onload=function(){200===this.status||0===this.status?e(i.response):n&&n("Could not load image："+t),i=null},i.open("GET",t,!0),i.responseType="arraybuffer",i.send(null)}function O(t,e,n){var i=new M.FileReader;i.onload=function(t){e(t.target.result)},i.onerror=n||function(t){console.error("fileToArrayBuffer error: ",t)},i.readAsArrayBuffer(t)}function D(t){var e=new DataView(t);if(65496!==e.getUint16(0,!1))return-2;for(var n=e.byteLength,i=2;i<n;){var o=e.getUint16(i,!1);if(i+=2,65505===o){if(1165519206!==e.getUint32(i+=2,!1))return-1;var a=18761===e.getUint16(i+=6,!1);i+=e.getUint32(i+4,a);var r=e.getUint16(i,a);i+=2;for(var s=0;s<r;s++)if(274===e.getUint16(i+12*s,a))return e.getUint16(i+12*s+8,a)}else{if(65280!=(65280&o))break;i+=e.getUint16(i,!1)}}return-1}function L(t,e,n,i){var o=t.naturalWidth,a=t.naturalHeight;if(o+a){var r=n.width,s=n.height,c=e.getContext("2d");c.save();H(t)&&(o/=2,a/=2);var l=1024,u=document.createElement("canvas");u.width=u.height=l;for(var f=u.getContext("2d"),d=i?I(t,o,a):1,h=X.ceil(l*r/o),v=X.ceil(l*s/a/d),m=0,p=0;m<a;){for(var g=0,y=0;g<o;)f.clearRect(0,0,l,l),f.drawImage(t,-g,-m),c.drawImage(u,0,0,l,l,y,p,h,v),g+=l,y+=h;m+=l,p+=v}c.restore(),u=f=null}}function H(t){var e=t.naturalWidth;if(e*t.naturalHeight>1048576){var n=document.createElement("canvas");n.width=n.height=1;var i=n.getContext("2d");return i.drawImage(t,1-e,0),0===i.getImageData(0,0,1,1).data[3]}return!1}function I(t,e,n){var i=document.createElement("canvas");i.width=1,i.height=n;var o=i.getContext("2d");o.drawImage(t,0,0);for(var a=o.getImageData(0,0,1,n).data,r=0,s=n,c=n;c>r;){0===a[4*(c-1)+3]?s=c:r=c,c=s+r>>1}var l=c/n;return 0===l?1:l}function U(t,e,n,i,o){switch([5,6,7,8].indexOf(o)>-1?(t.width=i,t.height=n):(t.width=n,t.height=i),o){case 2:e.transform(-1,0,0,1,n,0);break;case 3:e.transform(-1,0,0,-1,n,i);break;case 4:e.transform(1,0,0,-1,0,i);break;case 5:e.transform(0,1,1,0,0,0);break;case 6:e.transform(0,1,-1,0,i,0);break;case 7:e.transform(0,-1,-1,0,i,n);break;case 8:e.transform(0,-1,1,0,0,n);break;default:e.transform(1,0,0,1,0,0)}}function j(t,e,n,i){var o=t/e,a=n,r=a/o,s=0,c=-(r-i)/2;return r<i&&(r=i,a=o*r,s=-(a-n)/2,c=0),{width:a,height:r,x:s,y:c,scale:+(a/t).toFixed(4)}}function _(t,e,n){var i=new M.Image;return ut(t)||(i.crossOrigin="*"),i.onload=function(){e(i)},i.onerror=n||function(t){console.error("loadImage error: ",t)},i.src=t,i}function z(t,n,i){function o(t,e,i){function o(t,e){a.orientation?U(r,l,t,e,i):(r.width=t,r.height=e)}var r=document.createElement("canvas"),s=e.width,c=e.height,l=r.getContext("2d");if(dt&&dt[K.ios.version]&&s*c>dt[K.ios.version]){var u=X.sqrt(dt[K.ios.version]),f=W(e,V({},a,{maxWidth:u,maxHeight:u}));o(f.width,f.height),L(e,r,f,!0)}else o(s,c),l.drawImage(e,0,0);n(r)}var a=G({orientation:!0,errorCallback:e},i),r="";if(M.FileReader&&(t instanceof M.Blob||t instanceof M.File))r="file";else if(lt(t))r="objectURL";else if(t&&t.tagName&&t.nodeType){if("IMG"===t.tagName&&(r="imageEl"),"CANVAS"===t.tagName)return void n(t)}else r="url";ft[r].toImage(t,function(e){a.orientation?ft[r].getArrayBuffer(t,function(n){var i=D(n);o(t,e,i)},a.errorCallback):o(t,e)},a.errorCallback)}function W(t,e){var n=e.maxWidth,i=e.maxHeight,o=e.width,a=e.height,r=t.naturalWidth,s=t.naturalHeight;return o&&!a?a=s*o/r<<0:a&&!o?o=r*a/s<<0:(o=r,a=s),n&&r>n&&(o=n,a=s*o/r<<0),i&&a>i&&(a=i,o=r*a/s<<0),{width:o,height:a}}function q(t){t.position={x:0,y:0,width:0,height:0,scale:1},t.image={width:0,height:0,el:null}}function P(t){var e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),e}function F(t,e){var n=P(t),i=n.getContext("2d"),o=document.createElement("canvas"),a=o.getContext("2d"),r=n.width,s=n.height,c=X.ceil(r*e),l=X.ceil(s*e);o.width=c,o.height=l;for(var u=X.ceil(X.log(r/c)/X.log(3)),f=0;f<u;f++)i.drawImage(n,0,0,.5*r,.5*s);return a.drawImage(n,0,0,n.width*X.pow(.5,u),n.height*X.pow(.5,u),0,0,c,l),i=null,n=null,o}function N(t,e,n,i,o,a,r,s,c){var l=document.createElement("canvas"),u=l.width=X.floor(s),f=l.height=X.floor(c);return l.getContext("2d").drawImage(t,X.floor(e),X.floor(n),X.floor(i),X.floor(o),X.floor(a),X.floor(r),u,f),l}var M=window,X=M.Math;!function(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&i.firstChild?i.insertBefore(o,i.firstChild):i.appendChild(o),o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t))}}('.crop-container{position:fixed;left:0;top:0;overflow:hidden;background:#000;z-index:4;-ms-touch-action:none;touch-action:none;-webkit-transition:transform .3s;transition:transform .3s;-webkit-transition:-webkit-transform .3s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.crop-hide{display:none}.crop-slide-to-left{-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}.crop-slide-to-right{-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0)}.crop-slide-to-top{-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}.crop-slide-to-bottom{-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0)}.crop-zoom{position:absolute;z-index:2;width:100%;height:100%;left:0;top:0}.crop-mask{position:absolute;overflow:hidden;border:1px solid rgba(0,0,0,.6);-webkit-transform:translateZ(0);transform:translateZ(0);-webkit-box-sizing:content-box;box-sizing:content-box;z-index:1}.crop-mask:before{top:0;float:left;content:"";height:100%;border:1px solid #fff;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-transform-origin:0 0;transform-origin:0 0}.crop-handle,.crop-mask:before{position:absolute;left:0;width:100%}.crop-handle{bottom:0;height:50px;line-height:50px;-webkit-transform:translateZ(0);transform:translateZ(0);z-index:3}.crop-handle div{height:100%;width:80px;color:#fff;font-size:16px;text-align:center}.crop-cancle{float:left}.crop-confirm{float:right}');var Y=Object.prototype.toString,Z=Array.prototype.slice,G=r(function(t,e,o){var a=e[o];i(a)?(t[o]=n(a)?{}:[],G(t[o],a)):t[o]=a}),V=Object.assign||r(function(t,e,n){var i=e[n];t[n]=i}),K=function(){var t=navigator.userAgent;return{ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&{version:+t.match(/[OS\s]\d+/i)[0]}}}(),Q=/\S+/g,J=function(){function t(t,e){return e=Array.isArray(e)?e.join(" "):e.match(Q).join(" "),""===t?e:t+" "+e}function e(t,e){return(Array.isArray(e)?e:e.match(Q)).forEach(function(e){t=t.replace(new RegExp(""+e,"g"),"")}),t.trim()}return function(n,i){var o=n.className;i.remove&&(o=e(o,i.remove)),i.add&&(o=t(o,i.add)),n.className=o}}(),$=function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){return t=!0,$=function(){return!0},!0}});M.addEventListener("testPassive",null,e),M.removeEventListener("testPassive",null,e)}catch(t){$=function(){return!1}}return t},tt={render:function(){var t=this,e=t.options,n=e.el,i=e.canvasRatio,o=e.width;n.appendChild(t.canvas),t.rect=t.canvas.getBoundingClientRect(),t.canvasRatio=i||o/t.rect.width}},et={bindEvent:function(){var t=this,e=t.options.touchTarget||t.canvas;t.eventList.forEach(function(n){v(e,n,t[n]=t[n].bind(t),{passive:!1})})},removeEvent:function(){var t=this,e=t.options.touchTarget||t.canvas;t.eventList.forEach(function(n){e.removeEventListener(n,t[n])})},mousewheel:function(t){t.preventDefault();var e=t.deltaY,n=X.pow(.99,e);this.mousescroll(t,n)},mousescroll:function(t,e){var n=this;n.rect||(n.rect=n.canvas.getBoundingClientRect()),n.last.point={x:(t.clientX-n.rect.left)*n.canvasRatio,y:(t.clientY-n.rect.top)*n.canvasRatio},n.scaleTo(n.last.point,n.position.scale*e),clearTimeout(n.mouseScrollTimer),n.mouseScrollTimer=setTimeout(function(){var t=n.validation();t.isDraw&&n.animate(t.scale,t.xpos,t.ypos)},200),n.emit("mousewheel",t)},mousedown:function(t){t.preventDefault();var e=this;e.touchstart(t),C(e.touchmove,e.touchend)},touchstart:function(t){t.preventDefault();var e=this,n=E(t);e.moved=!1,e.animation.stop(),2===n.length?e.pinchstart(t):1===n.length&&e.dragstart(t)},touchmove:function(t){t.preventDefault();var e=this,n=E(t);e.moved=!0,2===n.length?e.pinchmove(t):1===n.length&&e.dragmove(t)},touchend:function(t){var e=this,n=t.touches||[],i=Date.now();if(!e.moved){i-e.upTime<=300&&e.dobuleClick()}e.upTime=i,n.length?(e.emit("pinchend",t),e.dragstart(t)):e.dragend(t)},dragstart:function(t){var e=this,n=E(t);e.last.move={x:n[0].clientX,y:n[0].clientY},e.last.dis={time:0,x:0,y:0},e.last.time=(new Date).getTime(),e.touchDelay=3,e.emit("dragstart",t)},dragmove:function(t){var e=this,n=E(t),i={x:n[0].clientX,y:n[0].clientY},o=(i.x-e.last.move.x)*e.canvasRatio,a=(i.y-e.last.move.y)*e.canvasRatio,r=(new Date).getTime();if(e.last.dis={x:o,y:a,time:r-e.last.time},e.last.time=r,e.last.move=i,e.touchDelay)return void e.touchDelay--;e.moveTo(e.position.x+o,e.position.y+a),e.emit("dragmove",t)},dragend:function(t){var e=this;if(e.moved){var n=e.position,i=e.last.dis.x/e.last.dis.time,o=e.last.dis.y/e.last.dis.time,a=n.scale;if(X.abs(i)>.3||X.abs(o)>.3){var r=n.x+420*i,s=n.y+420*o,c="easeOutCubic",l=e.validation({x:r,y:s,scale:a});l.isDraw&&(r=l.xpos,s=l.ypos,a=l.scale,c="easeOutBack"),e.animate(a,r,s,{type:c,time:840})}else{var u=e.validation();u.isDraw&&e.animate(u.scale,u.xpos,u.ypos)}e.emit("dragend",t)}},pinchstart:function(t){var e=this,n=E(t),i=c(n).map(function(t){return{x:t.clientX,y:t.clientY}}),o=g(i);e.rect=e.canvas.getBoundingClientRect(),e.last.zoom=i,e.last.point={x:(o.x-e.rect.left)*e.canvasRatio,y:(o.y-e.rect.top)*e.canvasRatio},e.touchDelay=5,e.emit("pinchstart",t)},pinchmove:function(t){var e=this,n=E(t),i=c(n).map(function(t){return{x:t.clientX,y:t.clientY}}),o=g(i),a={x:(o.x-e.rect.left)*e.canvasRatio,y:(o.y-e.rect.top)*e.canvasRatio},r=a.x-e.last.point.x,s=a.y-e.last.point.y,l=b(e.last.zoom,i);if(e.last.zoom=i,e.last.point=a,e.touchDelay)return void e.touchDelay--;e.position.x+=r,e.position.y+=s,e.scaleTo(a,e.position.scale*l),e.emit("pinchmove",t)},dobuleClick:function(){var t=this,e=t.canvas.getBoundingClientRect(),n=t.options,i=n.maxScale,o=n.minScale,a={x:(t.last.move.x-e.left)*t.canvasRatio,y:(t.last.move.y-e.top)*t.canvasRatio},r=t.position.scale;r=r<i?i:o,t.scaleTo(a,r,!0,!0)}},nt={easeOutStrong:function(t,e,n,i){return-n*((t=t/i-1)*t*t*t-1)+e},easeOutCubic:function(t,e,n,i){return n*((t=t/i-1)*t*t+1)+e},easeOutBack:function(t,e,n,i,o){return void 0===o&&(o=1.70158),n*((t=t/i-1)*t*((o+1)*t+o)+1)+e}},it=M.requestAnimationFrame||M.webkitRequestAnimationFrame||function(t){return M.setTimeout(t,1e3/60)},ot=M.cancelAnimationFrame||function(t){clearTimeout(t)};M.requestAnimationFrame=it,M.cancelAnimationFrame=ot;var at=function(){return(new Date).getTime()},rt={time:500,type:"easeOutQuad"},st=function(t){function e(){var t=at(),i=1-(X.max(0,l-t+o)/o||0),u=[];r.forEach(function(t){var e=t[0]===t[1]?t[0]:nt[a](i*o,t[0],t[1]-t[0],o)||0;u.push(e)}),s(u),1===i?(ot(n),c&&c()):n=it(e)}var n=null,i=G({},rt,t),o=i.time,a=i.type,r=i.targets,s=i.running,c=i.end,l=at();return n=it(e),{stop:function(){ot(n)}}},ct=M.URL&&M.URL.createObjectURL?M.URL:M.webkitURL&&M.webkitURL.createObjectURL?M.webkitURL:null,lt=function(t){return/^blob:/i.test(t)},ut=function(t){return t.indexOf(";base64,")>0},ft={url:{getArrayBuffer:S,toImage:_},file:{getArrayBuffer:O,toImage:function(t,e,n){_(ct.createObjectURL(t),e,n)}},objectURL:{getArrayBuffer:function(t,e,n){B(t,function(t){O(t,e,n)})},toImage:_},base64:{getArrayBuffer:function(t,e,n){O(A(t),e,n)},toImage:_},imageEl:{getArrayBuffer:function(t,e,n){S(t.src,e,n)},toImage:function(t,e){e(t)}}},dt=function(){return K.ios?{8:4e6,9:16777216}:null}(),ht={load:function(t,e){var n=this;z(t,function(t){n.initImageData(t),n.draw(),n.renderAction(),s(function(){e&&e(),n.emit("loaded",n)})},{errorCallback:function(t){n.emit("error",t)}})},initImageData:function(t){var e=this,n=e.options,i=n.width,o=n.height,a=n.offset,r=n.maxScale,s={el:t,width:t.width,height:t.height},c=i-(a.left+a.right),l=o-(a.top+a.bottom),u=j(s.width,s.height,c,l);u.x+=a.left,u.y+=a.top;var f=X.max(u.scale,r),d=u.scale;e.options.maxScale=f===d?u.scale*X.max(r,1):r,e.options.minScale=d,e.position=u,e.image=s},destroy:function(){var t=this;t.removeEvent(),d(t.canvas)&&t.options.el.removeChild(t.canvas)},draw:function(){var t=this,e=t.context,n=t.options,i=n.width,o=n.height,a=t.position,r=a.x,s=a.y,c=a.scale;e.clearRect(0,0,i,o),e.save(),t.context.translate(r,s),e.scale(c,c),e.drawImage(t.image.el,0,0),e.restore()},setData:function(t){var e=this,n={x:1,y:1,scale:4};for(var i in t)e.position[i]=k(t[i],n[i])},moveTo:function(t,e,n){var i=this;n?i.animate(i.position.scale,t,e):(i.setData({x:t,y:e}),i.draw())},scaleTo:function(t,e,n,i){var o=this;if(e!==o.position.scale){var a=w(o.position,t,e),r=a.x,s=a.y;if(i){var c=o.checkBorder({x:r,y:s},e,{x:r,y:s});r=c.xpos,s=c.ypos}n?o.animate(e,r,s):(o.setData({scale:e}),o.moveTo(r,s))}},animate:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{time:450,type:"easeOutCubic"},o=this;o.animation.stop(),o.animation=st({targets:[[o.position.scale,t],[o.position.x,e],[o.position.y,n]],time:i.time,type:i.type,running:function(t){o.setData({scale:t[0],x:t[1],y:t[2]}),o.draw()}})}},vt={validation:function(t){function e(e){var i=w(t,n.last.point,e),o=i.x,a=i.y;s=n.checkBorder({x:o,y:a},e,{x:o,y:a}),s.scale=e,s.isDraw=!0}var n=this;t=t||n.position;var i=n.options,o=i.maxScale,a=i.minScale,r=t.scale,s={xpos:t.x,ypos:t.y,isDraw:!1};return r>o?e(o):r<a?e(a):(s=n.checkBorder(t,r,t),s.scale=r),s},checkBorder:function(t,e,n){var i=this,o=i.options,a=o.width,r=o.height,s=o.offset,c=e*i.image.width,l=e*i.image.height,u=a-(s.left+s.right)-(c-(s.left-n.x)),f=r-(s.top+s.bottom)-(l-(s.top-n.y)),d=t.x,h=t.y,v=!1;return h>s.top?(h=s.top,v=!0):f>0&&(h+=f,v=!0),d>s.left?(d=s.left,v=!0):u>0&&(d+=u,v=!0),{xpos:d,ypos:h,isDraw:v}}},mt=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},pt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),gt=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},yt=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},bt=Array.prototype.slice,wt=function(){function t(){mt(this,t),this.events={}}return pt(t,[{key:"on",value:function(t,e,n){var i=this;return t.split(" ").forEach(function(t){i.events[t]||(i.events[t]=[]),e&&i.events[t].push({fn:e,once:n})}),i}},{key:"emit",value:function(t){var e=this,n=bt.call(arguments,1);t=t.split(" ").forEach(function(t){var i=e.events[t];if(i)for(var o=i.length,a=0;a<o;a++){var r=i[a];r&&(i[a].fn.apply(e,n),i[a].once&&i.splice(a--,1))}})}},{key:"off",value:function(t,e){var n=this,i=n.events[t];if(i){if(!e)return void(n.events[t]=[]);for(var o=i.length,a=0;a<o;a++)if(i[a]&&i[a].fn===e){i.splice(a,1);break}}else t||(n.events={})}}]),t}(),xt=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};mt(this,e);var n=yt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),i=n;return t.el&&(t.el=f(t.el)),i.options=G({},e.defaults,t),i.init(),n}return gt(e,t),pt(e,[{key:"init",value:function(){var t=this;R(t),T(t),q(t)}}]),e}(wt);xt.defaults={el:document.body,width:2*document.documentElement.clientWidth,height:2*document.documentElement.clientHeight,maxScale:2,touchTarget:null,offset:{left:0,right:0,top:0,bottom:0}},V(xt.prototype,tt,et,ht,vt);var kt=document.documentElement.clientWidth,Ct=document.documentElement.clientHeight,Et=.9*X.min(kt,Ct),Rt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};mt(this,e);var n=this;n.options=G({},e.defaults,t),n.border=n.options.border,n.elements={},n.isHide=!0,n.init()}return pt(e,[{key:"init",value:function(){this.initElement(),this.initCanvas(),this.initEvent()}},{key:"initElement",value:function(){var n=this,i=n.options,o=i.viewWidth,a=i.viewHeight,r=document.createElement("div");r.innerHTML=t(n.options),c(r.querySelectorAll("*")).forEach(function(t){var e=t.getAttribute("data-el");e&&(n.elements[e]=t)}),h(n.elements.container,{width:o,height:a}),J(n.elements.container,{add:e.CROP_HIDE_CLASS}),n.setBorder(n.border)}},{key:"initCanvas",value:function(){var t=this,e=t.options,n=e.canvasRatio,i=e.maxScale,o=e.viewWidth,a=e.viewHeight,r={maxScale:i,canvasRatio:n,el:t.elements.container,touchTarget:t.elements.zoom,width:o*n,height:a*n,offset:t.canvasOffset};t.canvas=new xt(r)}},{key:"initEvent",value:function(){var t=this;t.onClick=t.onClick.bind(t),t.transitionend=t.transitionend.bind(t),t.canvas.on("loaded",t.render.bind(t),!0),t.canvas.on("loaded",t.show.bind(t)),v(t.elements.container,"click",t.onClick),v(t.elements.container,"transitionend",t.transitionend),v(t.elements.container,"webkitTransitionEnd",t.transitionend)}},{key:"load",value:function(t){this.canvas.load(t)}},{key:"onClick",value:function(t){var e=t.target.getAttribute("data-click");e&&this[e]&&this[e]()}},{key:"onCancle",value:function(){this.emit("cancle",this)}},{key:"onConfirm",value:function(){this.emit("confirm",this)}},{key:"transitionend",value:function(t){var n=this,i=t.target;i===n.elements.container&&n.isHide&&J(i,{add:e.CROP_HIDE_CLASS,remove:n.options.beforeHideClass})}},{key:"render",value:function(){this.options.el.appendChild(this.elements.container)}},{key:"get",value:function(t){var e=this,n=e.options.canvasRatio,i=e.canvas.position,o=i.scale,a=i.x,r=i.y,s=e.border.width*n/o,c=e.border.height*n/o,l=(e.border.x*n-a)/o,u=(e.border.y*n-r)/o,f=void 0;t=V({width:s,height:c,type:"image/jpeg",format:"base64",quality:.85},t||{});var d=t.width/s,h=X.ceil(X.log(s/(s*d))/X.log(3))>=3,v=function(t,n){return N(e.canvas.image.el,l,u,s,c,0,0,t,n)};f=h?F(v(s,c),d):v(t.width,X.round(c*(t.width/s)));var m={base64:function(){return f.toDataURL(t.type,t.quality)},file:function(){return A(m.base64())},objectUrl:function(){return ct.createObjectURL(m.file())},canvas:function(){return f}};if(m[t.format])return m[t.format]();throw new Error("Undefined format: "+t.format+", Try: base64|file|objectUrl|canvas")}},{key:"setBorder",value:function(t){var e=this,n=e.checkBorder(t),i=n.x,o=n.y,a=n.width,r=n.height,s=e.options,c=s.canvasRatio,l=s.viewWidth,u=s.viewHeight,f={width:a,height:r,left:i-l,top:o-u,borderWidth:u+"px "+l+"px"},d={left:i*c,top:o*c,right:(l-a-i)*c,bottom:(u-r-o)*c};e.canvas&&(e.canvas.options.offset=d),h(e.elements.mask,f),e.border=t,e.canvasOffset=d}},{key:"checkBorder",value:function(t){var e=t.x,n=t.y,i=t.width,o=t.height,r=this.options,s=r.viewWidth,c=r.viewHeight;return t.width=a(i)?i:s,t.height=a(o)?o:c,t.x=a(e)?e:(s-t.width)/2,t.y=a(n)?n:(c-t.height)/2,t}},{key:"on",value:function(){return this.canvas.on.apply(this.canvas,arguments)}},{key:"emit",value:function(){this.canvas.emit.apply(this.canvas,arguments)}},{key:"off",value:function(){this.canvas.off.apply(this.canvas,arguments)}},{key:"show",value:function(t){var n=this;n.isHide&&M.requestAnimationFrame(function(){var i=n.elements.container,o=n.options;!1===t?J(i,{remove:e.CROP_HIDE_CLASS}):(J(i,{remove:e.CROP_HIDE_CLASS,add:o.beforeShowClass}),s(function(){J(i,{remove:o.beforeShowClass})})),n.isHide=!1})}},{key:"hide",value:function(t){var n=this;n.isHide||M.requestAnimationFrame(function(){var i=n.elements.container;!1===t?J(i,{add:e.CROP_HIDE_CLASS}):J(i,{add:n.options.beforeHideClass}),n.isHide=!0})}},{key:"destroy",value:function(){var t=this,e=t.elements.container;t.canvas.destroy(),m(e,"click",t.onClick),m(e,"transitionend",t.transitionend),m(e,"webkitTransitionEnd",t.transitionend),d(e)&&t.options.el.removeChild(e)}}]),e}();return Rt.defaults={viewWidth:kt,viewHeight:Ct,el:document.body,border:{width:Et,height:Et},maxScale:2,canvasRatio:2,confirmText:"确认",cancleText:"取消",beforeShowClass:"crop-slide-to-right",beforeHideClass:"crop-slide-to-bottom"},Rt.imageToCanvas=z,Rt.Canvas=xt,Rt.CROP_HIDE_CLASS="crop-hide",Rt});
