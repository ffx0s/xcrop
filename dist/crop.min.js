/*!
   * @name xcrop v1.1.0
   * @github https://github.com/ffx0s/xcrop
   * @license MIT.
   */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Crop=e()}(this,function(){"use strict";function t(t){return'<div class="crop-container crop-hide" data-el="container"><div class="crop-mask" data-el="mask"></div><div class="crop-handle" data-el="handle"><div class="crop-cancle" data-el="cancle" data-touchstart="onCancle">'+t.cancleText+'</div><div class="crop-confirm" data-el="confirm" data-touchstart="onConfirm">'+t.confirmText+"</div></div></div>"}function e(){}function n(t){return"[object Object]"===X.call(t)}function i(t){return n(t)||Array.isArray(t)}function o(t){return"string"==typeof t}function a(t){return"number"==typeof t&&t!==1/0&&!isNaN(t)}function r(t){return function(e){if(null!==e&&void 0!==e){for(var n=arguments,i=n.length,o=1;o<i;o++)!function(i){var o=n[i];if(null===o||void 0===o)return!1;Object.keys(o).forEach(function(n){t(e,o,n)})}(o);return e}}}function s(t,e){setTimeout(t,e||0)}function c(t){return _.call(t)}function l(t){return t.charAt(0).toUpperCase()+t.slice(1)}function u(t,e){return t+e}function f(t){return{x:t.map(function(t){return t.x}).reduce(u)/t.length,y:t.map(function(t){return t.y}).reduce(u)/t.length}}function h(t,e,n){n=n||["x","y"];var i=e[n[0]]-t[n[0]],o=e[n[1]]-t[n[1]];return N.sqrt(i*i+o*o)}function d(t,e){return h(e[0],e[1])/h(t[0],t[1])}function v(t,e,n,i,o){var a=n.x-t.x,r=n.y-t.y,s=t.x+a*(1-o),c=t.y+r*(1-o),l=s-e.x,u=c-e.y;return{scale:i*o,x:e.x+l,y:e.y+u}}function m(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n.style.cssText="width:100%;height:100%;",n}function p(t,e){return+t.toFixed(e)}function g(t){t.canvas=m(t.options.width,t.options.height),t.context=t.canvas.getContext("2d"),t.renderAction=function(){t.bindEvent(),t.render(),t.renderAction=e}}function y(t){t.eventList=["mousewheel","touchstart","touchmove","touchend"],t.last={point:{x:0,y:0},move:{x:0,y:0},time:0,dis:{time:0,x:0,y:0}},t.touchDelay=3,t.animation={stop:e},t.wheeling=!1}function w(t){var e=void 0;e=t.split(",")[0].indexOf("base64")>=0?z.atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var n=t.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(e.length),o=new Uint8Array(i),a=0;a<e.length;a++)o[a]=e.charCodeAt(a);var r=void 0;try{r=new z.Blob([i],{type:n})}catch(t){if(z.BlobBuilder=z.BlobBuilder||z.WebKitBlobBuilder||z.MozBlobBuilder||z.MSBlobBuilder,"TypeError"===t.name&&z.BlobBuilder){var s=new z.BlobBuilder;s.append(o.buffer),r=s.getBlob(n)}else"InvalidStateError"===t.name&&(r=new z.Blob([i],{type:n}))}return r}function b(t,e){var n=new z.XMLHttpRequest;n.open("GET",t,!0),n.responseType="blob",n.onload=function(t){200!==this.status&&0!==this.status||e(this.response)},n.send()}function x(t,e,n){var i=new z.XMLHttpRequest;i.onload=function(){200===this.status||0===this.status?e(i.response):n&&n("Could not load image："+t),i=null},i.open("GET",t,!0),i.responseType="arraybuffer",i.send(null)}function k(t,e,n){var i=new z.FileReader;i.onload=function(t){e(t.target.result)},i.onerror=n||function(t){console.error("fileToArrayBuffer error: ",t)},i.readAsArrayBuffer(t)}function C(t){var e=new DataView(t);if(65496!==e.getUint16(0,!1))return-2;for(var n=e.byteLength,i=2;i<n;){var o=e.getUint16(i,!1);if(i+=2,65505===o){if(1165519206!==e.getUint32(i+=2,!1))return-1;var a=18761===e.getUint16(i+=6,!1);i+=e.getUint32(i+4,a);var r=e.getUint16(i,a);i+=2;for(var s=0;s<r;s++)if(274===e.getUint16(i+12*s,a))return e.getUint16(i+12*s+8,a)}else{if(65280!=(65280&o))break;i+=e.getUint16(i,!1)}}return-1}function E(t,e,n,i){var o=t.naturalWidth,a=t.naturalHeight;if(o+a){var r=n.width,s=n.height,c=e.getContext("2d");c.save();R(t)&&(o/=2,a/=2);var l=1024,u=document.createElement("canvas");u.width=u.height=l;for(var f=u.getContext("2d"),h=i?B(t,o,a):1,d=N.ceil(l*r/o),v=N.ceil(l*s/a/h),m=0,p=0;m<a;){for(var g=0,y=0;g<o;)f.clearRect(0,0,l,l),f.drawImage(t,-g,-m),c.drawImage(u,0,0,l,l,y,p,d,v),g+=l,y+=d;m+=l,p+=v}c.restore(),u=f=null}}function R(t){var e=t.naturalWidth;if(e*t.naturalHeight>1048576){var n=document.createElement("canvas");n.width=n.height=1;var i=n.getContext("2d");return i.drawImage(t,1-e,0),0===i.getImageData(0,0,1,1).data[3]}return!1}function B(t,e,n){var i=document.createElement("canvas");i.width=1,i.height=n;var o=i.getContext("2d");o.drawImage(t,0,0);for(var a=o.getImageData(0,0,1,n).data,r=0,s=n,c=n;c>r;){0===a[4*(c-1)+3]?s=c:r=c,c=s+r>>1}var l=c/n;return 0===l?1:l}function T(t,e,n,i,o){switch([5,6,7,8].indexOf(o)>-1?(t.width=i,t.height=n):(t.width=n,t.height=i),o){case 2:e.transform(-1,0,0,1,n,0);break;case 3:e.transform(-1,0,0,-1,n,i);break;case 4:e.transform(1,0,0,-1,0,i);break;case 5:e.transform(0,1,1,0,0,0);break;case 6:e.transform(0,1,-1,0,i,0);break;case 7:e.transform(0,-1,-1,0,i,n);break;case 8:e.transform(0,-1,1,0,0,n);break;default:e.transform(1,0,0,1,0,0)}}function O(t,e,n,i){var o=t/e,a=n,r=a/o,s=0,c=-(r-i)/2;return r<i&&(r=i,a=o*r,s=-(a-n)/2,c=0),{width:a,height:r,x:s,y:c,scale:+(a/t).toFixed(4)}}function A(t,e,n){var i=new z.Image;return ot(t)||(i.crossOrigin="*"),i.onload=function(){e(i)},i.onerror=n||function(t){console.error("loadImage error: ",t)},i.src=t,i}function D(t,n,i){function o(t,e,i){function o(t,e){a.orientation?T(r,l,t,e,i):(r.width=t,r.height=e)}var r=document.createElement("canvas"),s=e.width,c=e.height,l=r.getContext("2d");if(rt&&rt[Z.ios.version]&&s*c>rt[Z.ios.version]){var u=N.sqrt(rt[Z.ios.version]),f=U(e,P({},a,{maxWidth:u,maxHeight:u}));o(f.width,f.height),E(e,r,f,!0)}else o(s,c),l.drawImage(e,0,0);n(r)}var a=Y({orientation:!0,errorCallback:e},i),r="";if(z.FileReader&&(t instanceof z.Blob||t instanceof z.File))r="file";else if(it(t))r="objectURL";else if(t&&t.tagName&&t.nodeType){if("IMG"===t.tagName&&(r="imageEl"),"CANVAS"===t.tagName)return void n(t)}else r="url";at[r].toImage(t,function(e){a.orientation?at[r].getArrayBuffer(t,function(n){var i=C(n);o(t,e,i)},a.errorCallback):o(t,e)},a.errorCallback)}function U(t,e){var n=e.maxWidth,i=e.maxHeight,o=e.width,a=e.height,r=t.naturalWidth,s=t.naturalHeight;return o&&!a?a=s*o/r<<0:a&&!o?o=r*a/s<<0:(o=r,a=s),n&&r>n&&(o=n,a=s*o/r<<0),i&&a>i&&(a=i,o=r*a/s<<0),{width:o,height:a}}function I(t){return o(t)?document.querySelector(t):t}function L(t){return document.body.contains(t)}function j(t,e){for(var n in e){var i=a(e[n])?e[n]+"px":e[n];-1!==["transform","transformOrigin","transition"].indexOf(n)?t.style["Webkit"+l(n)]=t.style[n]=i:t.style[n]=i}}function S(t){t.firstOrigin={x:0,y:0},t.position={x:0,y:0,width:0,height:0,scale:1},t.image={width:0,height:0,el:null}}function H(t){var e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),e}function W(t,e){var n=H(t),i=n.getContext("2d"),o=document.createElement("canvas"),a=o.getContext("2d"),r=n.width,s=n.height,c=N.ceil(r*e),l=N.ceil(s*e);o.width=c,o.height=l;for(var u=N.ceil(N.log(r/c)/N.log(3)),f=0;f<u;f++)i.drawImage(n,0,0,.5*r,.5*s);return a.drawImage(n,0,0,n.width*N.pow(.5,u),n.height*N.pow(.5,u),0,0,c,l),i=null,n=null,o}function q(t,e,n,i,o,a,r,s,c){var l=document.createElement("canvas"),u=l.width=N.floor(s),f=l.height=N.floor(c);return l.getContext("2d").drawImage(t,N.floor(e),N.floor(n),N.floor(i),N.floor(o),N.floor(a),N.floor(r),u,f),l}var z=window,N=z.Math;!function(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&i.firstChild?i.insertBefore(o,i.firstChild):i.appendChild(o),o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t))}}('.crop-container{position:fixed;left:0;top:0;overflow:hidden;background:#000;z-index:1;-webkit-transition:transform .3s;transition:transform .3s;-webkit-transition:-webkit-transform .3s}.crop-container.crop-hide{display:none}.crop-container.crop-slide-left{-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0)}.crop-container.crop-slide-right{-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}.crop-container.crop-slide-top{-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}.crop-container.crop-slide-bottom{-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0)}.crop-mask{position:absolute;overflow:hidden;border:1px solid rgba(0,0,0,.6);-webkit-transform:translateZ(0);transform:translateZ(0);-webkit-box-sizing:content-box;box-sizing:content-box}.crop-mask:before{position:absolute;left:0;top:0;float:left;content:"";width:200%;height:200%;border:1px solid #fff;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-transform:scale(.5);transform:scale(.5);-webkit-transform-origin:0 0;transform-origin:0 0}.crop-handle{position:absolute;bottom:0;left:0;width:100%;height:50px;line-height:50px;-webkit-transform:translateZ(0);transform:translateZ(0)}.crop-handle div{height:100%;width:80px;color:#fff;font-size:16px;text-align:center}.crop-cancle{float:left}.crop-confirm{float:right}');var F=document.documentElement.clientWidth,M=document.documentElement.clientHeight,X=Object.prototype.toString,_=Array.prototype.slice,Y=r(function(t,e,o){var a=e[o];i(a)?(t[o]=n(a)?{}:[],Y(t[o],a)):t[o]=a}),P=Object.assign||r(function(t,e,n){var i=e[n];t[n]=i}),Z=function(){var t=navigator.userAgent;return{ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&{version:+t.match(/[OS\s]\d+/i)[0]}}}(),G={render:function(){var t=this,e=t.options,n=e.el,i=e.canvasRatio,o=e.width;n.appendChild(t.canvas),t.rect=t.canvas.getBoundingClientRect(),t.canvasRatio=i||o/t.rect.width}},V={easeOutStrong:function(t,e,n,i){return-n*((t=t/i-1)*t*t*t-1)+e},easeOutCubic:function(t,e,n,i){return n*((t=t/i-1)*t*t+1)+e}},K=z.requestAnimationFrame||z.webkitRequestAnimationFrame||function(t){return z.setTimeout(t,1e3/60)},Q=z.cancelAnimationFrame||function(t){clearTimeout(t)},J=function(){return(new Date).getTime()},$={time:500,type:"easeOutQuad"},tt=function(t){function e(){var t=J(),i=1-(N.max(0,l-t+o)/o||0),u=[];r.forEach(function(t){var e=t[0]===t[1]?t[0]:V[a](i*o,t[0],t[1]-t[0],o)||0;u.push(e)}),s(u),1===i?(Q(n),c&&c()):n=K(e)}var n=null,i=Y({},$,t),o=i.time,a=i.type,r=i.targets,s=i.running,c=i.end,l=J();return n=K(e),{stop:function(){Q(n)}}},et={bindEvent:function(){var t=this,e=t.options.touchTarget||t.canvas;t.eventList.forEach(function(n){e.addEventListener(n,t[n]=t[n].bind(t))})},removeEvent:function(){var t=this,e=t.options.touchTarget||t.canvas;t.eventList.forEach(function(n){e.removeEventListener(n,t[n])})},mousewheel:function(t){t.preventDefault();var e=this;if(!e.wheeling){s(function(){e.wheeling=!1},30),e.wheeling=!0;var n=t.deltaY,i=N.pow(.99,n);e.rect=e.canvas.getBoundingClientRect(),e.last.point={x:(t.clientX-e.rect.left)*e.canvasRatio,y:(t.clientY-e.rect.top)*e.canvasRatio},e.scaleTo(e.last.point,e.position.scale*i),e.emit("mousewheel",t)}},touchstart:function(t){t.preventDefault();var e=this,n=t.touches;e.animation.stop(),2===n.length?e.pinchstart(t):1===n.length&&e.dragstart(t)},touchmove:function(t){var e=this,n=t.touches;2===n.length?e.pinchmove(t):1===n.length&&e.dragmove(t)},touchend:function(t){var e=this;t.touches.length?(e.emit("pinchend",t),e.dragstart(t)):e.dragend(t)},dragstart:function(t){var e=this,n=t.touches;e.last.move={x:n[0].clientX,y:n[0].clientY},e.last.dis={time:0,x:0,y:0},e.last.time=(new Date).getTime(),e.touchDelay=3,e.emit("dragstart",t)},dragmove:function(t){var e=this,n=t.touches,i={x:n[0].clientX,y:n[0].clientY},o=(i.x-e.last.move.x)*e.canvasRatio,a=(i.y-e.last.move.y)*e.canvasRatio,r=(new Date).getTime();if(e.last.dis={x:o,y:a,time:r-e.last.time},e.last.time=r,e.last.move=i,e.touchDelay)return void e.touchDelay--;e.moveTo(e.position.x+o,e.position.y+a),e.emit("dragmove",t)},dragend:function(t){var e=this;if(!e.validation()){var n=e.position,i=e.last.dis.x/e.last.dis.time,o=e.last.dis.y/e.last.dis.time;if(N.abs(i)>.4||N.abs(o)>.4){var a=n.x+300*i,r=n.y+300*o,s=e.checkBorder({x:a,y:r},n.scale,{x:a,y:r}),c=s.isDraw,l=s.xpos,u=s.ypos;c&&(a=l+8*i,r=u+8*o),e.animation=tt({time:600,targets:[[n.x,a],[n.y,r]],type:"easeOutCubic",running:function(t){e.setData({x:t[0],y:t[1]}),e.draw()},end:function(){e.validation()}})}}e.emit("dragend",t)},pinchstart:function(t){var e=this,n=c(t.touches).map(function(t){return{x:t.clientX,y:t.clientY}}),i=f(n);e.rect=e.canvas.getBoundingClientRect(),e.last.zoom=n,e.last.point={x:(i.x-e.rect.left)*e.canvasRatio,y:(i.y-e.rect.top)*e.canvasRatio},e.touchDelay=5,e.emit("pinchstart",t)},pinchmove:function(t){var e=this,n=c(t.touches).map(function(t){return{x:t.clientX,y:t.clientY}}),i=f(n),o={x:(i.x-e.rect.left)*e.canvasRatio,y:(i.y-e.rect.top)*e.canvasRatio},a=o.x-e.last.point.x,r=o.y-e.last.point.y,s=d(e.last.zoom,n);if(e.last.zoom=n,e.last.point=o,e.touchDelay)return void e.touchDelay--;e.position.x+=a,e.position.y+=r,e.scaleTo(o,e.position.scale*s),e.emit("pinchmove",t)}},nt=z.URL&&z.URL.createObjectURL?z.URL:z.webkitURL&&z.webkitURL.createObjectURL?z.webkitURL:null,it=function(t){return/^blob:/i.test(t)},ot=function(t){return t.indexOf(";base64,")>0},at={url:{getArrayBuffer:x,toImage:A},file:{getArrayBuffer:k,toImage:function(t,e,n){A(nt.createObjectURL(t),e,n)}},objectURL:{getArrayBuffer:function(t,e,n){b(t,function(t){k(t,e,n)})},toImage:A},base64:{getArrayBuffer:function(t,e,n){k(w(t),e,n)},toImage:A},imageEl:{getArrayBuffer:function(t,e,n){x(t.src,e,n)},toImage:function(t,e){e(t)}}},rt=function(){return Z.ios?{8:4e6,9:16777216}:null}(),st=/\S+/g,ct=function(){function t(t,e){return e=Array.isArray(e)?e.join(" "):e.match(st).join(" "),""===t?e:t+" "+e}function e(t,e){return(Array.isArray(e)?e:e.match(st)).forEach(function(e){t=t.replace(new RegExp(""+e,"g"),"")}),t.trim()}return function(n,i){var o=n.className;i.remove&&(o=e(o,i.remove)),i.add&&(o=t(o,i.add)),n.className=o}}(),lt={load:function(t,e){var n=this;D(t,function(t){n.initImageData(t),n.draw(),n.renderAction(),s(function(){e&&e(),n.emit("loaded",n)})},{errorCallback:function(t){n.emit("error",t)}})},initImageData:function(t){var e=this,n=e.options,i=n.width,o=n.height,a=n.offset,r=n.maxScale,s={el:t,width:t.width,height:t.height},c=i-(a.left+a.right),l=o-(a.top+a.bottom),u=O(s.width,s.height,c,l);u.x+=a.left,u.y+=a.top;var f=N.max(u.scale,r),h=u.scale;e.options.maxScale=f===h?u.scale*N.max(r,1):r,e.options.minScale=h,e.firstOrigin={x:u.x,y:u.y},e.position=u,e.image=s},destroy:function(){var t=this;t.removeEvent(),L(t.canvas)&&t.options.el.removeChild(t.canvas)},draw:function(){var t=this,e=t.context,n=t.options,i=n.width,o=n.height,a=t.position,r=a.x,s=a.y,c=a.scale;e.clearRect(0,0,i,o),e.save(),t.context.translate(r,s),e.scale(c,c),e.drawImage(t.image.el,0,0),e.restore()},setData:function(t){var e=this,n={x:1,y:1,scale:4};for(var i in t)e.position[i]=p(t[i],n[i])},moveTo:function(t,e,n){var i=this;n?i.animate(i.position.scale,t,e):(i.setData({x:t,y:e}),i.draw())},scaleTo:function(t,e){var n=this;if(e!==n.position.scale){var i=e/n.position.scale,o=v(n.position,n.firstOrigin,t,e/i,i),a=o.x,r=o.y;n.setData({scale:e}),n.moveTo(a,r)}},animate:function(t,e,n){var i=this;i.animation=tt({targets:[[i.position.scale,t],[i.position.x,e],[i.position.y,n]],time:450,type:"easeOutCubic",running:function(t){i.setData({scale:t[0],x:t[1],y:t[2]}),i.draw()}})}},ut={validation:function(){function t(t){var n=t/e.position.scale,i=v(e.position,e.firstOrigin,e.last.point,a,n),o=i.x,s=i.y;a=t,r=e.checkBorder({x:o,y:s},t,{x:o,y:s}),r.isDraw=!0}var e=this,n=e.options,i=n.maxScale,o=n.minScale,a=e.position.scale,r={xpos:e.position.x,ypos:e.position.y,isDraw:!1};return a>i?t(i):a<o?t(o):r=e.checkBorder(e.position,a,e.position),r.isDraw&&e.animate(a,r.xpos,r.ypos),r.isDraw},checkBorder:function(t,e,n){var i=this,o=i.options,a=o.width,r=o.height,s=o.offset,c=e*i.image.width,l=e*i.image.height,u=a-(s.left+s.right)-(c-(s.left-n.x)),f=r-(s.top+s.bottom)-(l-(s.top-n.y)),h=t.x,d=t.y,v=!1;return d>s.top?(d=s.top,v=!0):f>0&&(d+=f,v=!0),h>s.left?(h=s.left,v=!0):u>0&&(h+=u,v=!0),{xpos:h,ypos:d,isDraw:v}}},ft=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},ht=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),dt=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},vt=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},mt=Array.prototype.slice,pt=function(){function t(){ft(this,t),this.events={}}return ht(t,[{key:"on",value:function(t,e,n){var i=this;return t.split(" ").forEach(function(t){i.events[t]||(i.events[t]=[]),e&&i.events[t].push({fn:e,once:n})}),i}},{key:"emit",value:function(t){var e=this,n=mt.call(arguments,1);t=t.split(" ").forEach(function(t){var i=e.events[t];if(i)for(var o=i.length,a=0;a<o;a++){var r=i[a];r&&(i[a].fn.apply(e,n),i[a].once&&i.splice(a--,1))}})}},{key:"off",value:function(t,e){var n=this,i=n.events[t];if(i){if(!e)return void(n.events[t]=[]);for(var o=i.length,a=0;a<o;a++)if(i[a]&&i[a].fn===e){i.splice(a,1);break}}else t||(n.events={})}}]),t}(),gt={el:document.body,width:2*F,height:2*M,maxScale:2,touchTarget:null,offset:{left:0,right:0,top:0,bottom:0}},yt=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ft(this,e);var n=vt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),i=n;return t.el&&(t.el=I(t.el)),i.options=Y({},gt,t),i.init(),n}return dt(e,t),ht(e,[{key:"init",value:function(){var t=this;g(t),y(t),S(t)}}]),e}(pt);P(yt.prototype,G,et,lt,ut);var wt={el:document.body,viewWidth:F,viewHeight:M,maxScale:2,canvasRatio:2,confirmText:"确认",cancleText:"取消",showClass:"crop-slide-left",hideClass:"crop-slide-bottom"},bt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ft(this,e);var n=this;n.options=Y({},wt,t);var i=.8*N.min(n.options.viewWidth,n.options.viewHeight);n.border={x:(n.options.viewWidth-i)/2,y:(n.options.viewHeight-i)/2,width:i,height:i},n.elements={},n.init()}return ht(e,[{key:"init",value:function(){this.initElement(),this.initCanvas(),this.initEvent()}},{key:"initElement",value:function(){var e=this,n=e.options,i=n.showClass,o=n.viewWidth,a=n.viewHeight,r=document.createElement("div");r.innerHTML=t(e.options),c(r.querySelectorAll("*")).forEach(function(t){var n=t.getAttribute("data-el");n&&(e.elements[n]=t)}),j(e.elements.container,{width:o,height:a}),ct(e.elements.container,{add:i}),e.setBorder(e.border)}},{key:"initCanvas",value:function(){var t=this,e=t.options,n=e.canvasRatio,i=e.maxScale,o=e.viewWidth,a=e.viewHeight,r={maxScale:i,canvasRatio:n,el:t.elements.container,touchTarget:t.elements.container,width:o*n,height:a*n,offset:t.canvasOffset};t.canvas=new yt(r)}},{key:"initEvent",value:function(){var t=this;t.canvas.on("loaded",t.show.bind(t)),t.canvas.on("loaded",t.render.bind(t),!0),t.elements.container.addEventListener("touchstart",t.touchstart=t.touchstart.bind(t))}},{key:"touchstart",value:function(t){var e=t.target.getAttribute("data-touchstart");e&&this[e]&&this[e]()}},{key:"onCancle",value:function(){this.emit("cancle",this)}},{key:"onConfirm",value:function(){this.emit("confirm",this)}},{key:"render",value:function(){this.options.el.appendChild(this.elements.container)}},{key:"get",value:function(t){var e=this,n=e.options.canvasRatio,i=e.canvas.position,o=i.scale,a=i.x,r=i.y,s=e.border.width*n/o,c=e.border.height*n/o,l=(e.border.x*n-a)/o,u=(e.border.y*n-r)/o,f=void 0;t=P({width:s,height:c,type:"image/jpeg",format:"base64",quality:.85},t||{});var h=t.width/s,d=N.ceil(N.log(s/(s*h))/N.log(3))>=3,v=function(t,n){return q(e.canvas.image.el,l,u,s,c,0,0,t,n)};f=d?W(v(s,c),h):v(t.width,N.round(c*(t.width/s)));var m={base64:function(){return f.toDataURL(t.type,t.quality)},file:function(){return w(m.base64())},objectUrl:function(){return nt.createObjectURL(m.file())},canvas:function(){return f}};if(m[t.format])return m[t.format]();throw new Error("Undefined format: "+t.format+", Try: base64|file|objectUrl|canvas")}},{key:"setBorder",value:function(t){var e=this,n=t.x,i=t.y,o=t.width,a=t.height,r=e.options,s=r.canvasRatio,c=r.viewWidth,l=r.viewHeight,u={width:o,height:a,left:n-c,top:i-l,borderWidth:l+"px "+c+"px"},f={left:n*s,top:i*s,right:(c-o-n)*s,bottom:(l-a-i)*s};e.canvas&&(e.canvas.options.offset=f),j(e.elements.mask,u),e.border=t,e.canvasOffset=f}},{key:"load",value:function(t){this.canvas.load(t)}},{key:"on",value:function(){return this.canvas.on.apply(this.canvas,arguments)}},{key:"emit",value:function(){this.canvas.emit.apply(this.canvas,arguments)}},{key:"off",value:function(){this.canvas.off.apply(this.canvas,arguments)}},{key:"show",value:function(t){var e=this,n=this.elements.container,i=!1===t?0:30;s(function(){ct(n,{remove:"crop-hide"}),s(function(){ct(n,{remove:e.options.showClass})},i)})}},{key:"hide",value:function(t){var e=this,n=e.elements.container,i=!1===t?0:300;s(function(){ct(n,{add:e.options.hideClass}),s(function(){ct(n,{add:["crop-hide",e.options.showClass],remove:e.options.hideClass})},i)})}},{key:"destroy",value:function(){var t=this,e=t.elements.container;t.canvas.destroy(),e.removeEventListener("touchstart",t.touchstart),L(e)&&t.options.el.removeChild(e)}}]),e}();return bt.imageToCanvas=D,bt.Canvas=yt,bt});
