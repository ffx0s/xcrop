/*!
     * @name xcrop v1.1.17
     * @github https://github.com/ffx0s/xcrop
     * @license MIT.
     */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Crop=e()}(this,function(){"use strict";var d=window,g=d.Math;function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function e(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function t(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function r(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=o(n);return t=i?(t=o(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!=typeof t&&"function"!=typeof t?r(e):t}}!function(t,e){void 0===e&&(e={});var n,i=e.insertAt;t&&"undefined"!=typeof document&&(n=document.head||document.getElementsByTagName("head")[0],(e=document.createElement("style")).type="text/css","top"===i&&n.firstChild?n.insertBefore(e,n.firstChild):n.appendChild(e),e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t)))}('.crop{position:fixed;left:0;top:0;overflow:hidden;background:#000;z-index:99;-ms-touch-action:none;touch-action:none;-webkit-transition:transform .3s;transition:transform .3s;-webkit-transition:-webkit-transform .3s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.crop_hide{display:none}.crop_slide-to-left{-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}.crop_slide-to-right{-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0)}.crop_slide-to-top{-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}.crop_slide-to-bottom{-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0)}.crop__zoom{position:absolute;z-index:2;width:100%;height:100%;left:0;top:0}.crop__mask{position:absolute;overflow:hidden;border:1px solid rgba(0,0,0,.6);-webkit-box-sizing:content-box;box-sizing:content-box;z-index:1}.crop__mask:before{top:0;content:"";height:100%;border:1px solid #fff;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:inherit}.crop__handle,.crop__mask:before{position:absolute;left:0;width:100%}.crop__handle{bottom:0;height:50px;line-height:50px;-webkit-transform:translateZ(0);transform:translateZ(0);z-index:3}.crop__handle div{height:100%;width:80px;color:#fff;font-size:16px;text-align:center}.crop__handle-cancel{float:left}.crop__handle-confirm{float:right}');var a=Object.prototype.toString,l=Array.prototype.slice;function f(){}function u(t){return"[object Object]"===a.call(t)}function h(t){return"number"==typeof t&&t!==1/0&&!isNaN(t)}function m(o){return function(n){if(null!=n){for(var t=arguments,e=t.length,i=1;i<e;i++)!function(){var e=t[i];null!=e&&Object.keys(e).forEach(function(t){o(n,e,t)})}();return n}}}var v=m(function(t,e,n){var i=e[n];u(e=i)||Array.isArray(e)?(t[n]=u(i)?{}:[],v(t[n],i)):t[n]=i}),p=Object.assign||m(function(t,e,n){e=e[n];t[n]=e});var y=(et=navigator.userAgent,Q=!!et.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),{android:(et.match(/Android\s([0-9\\.]*)/)||[])[1]||!1,ios:Q&&{version:+et.match(/[OS\s]\d+/i)[0]}});function b(t){return l.call(t)}function w(n){var i=!1;return function(){var t,e=this;i||(t=arguments,d.requestAnimationFrame(function(){n.apply(e,t),i=!1}),i=!0)}}function x(t){return document.body.contains(t)}function k(t,e){for(var n in e){var i=h(e[n])?e[n]+"px":e[n];-1!==["transform","transformOrigin","transition"].indexOf(n)?t.style["Webkit"+((o=n).charAt(0).toUpperCase()+o.slice(1))]=t.style[n]=i:t.style[n]=i}var o}var C=/\S+/g,A=function(t,e){var n,i,o=t.className;e.remove&&(n=o,i=e.remove,(Array.isArray(i)?i:i.match(C)).forEach(function(t){n=n.replace(new RegExp("".concat(t),"g"),"")}),o=n.trim()),e.add&&(i=o,e=e.add,e=(Array.isArray(e)?e:e.match(C)).join(" "),o=""===i?e:i+" "+e),t.className=o},R=function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){return R=function(){return!0},t=!0}});d.addEventListener("testPassive",null,e),d.removeEventListener("testPassive",null,e)}catch(t){R=function(){return!1}}return t};function _(t,e,n,i){i=3<arguments.length&&void 0!==i?i:{capture:!1};t.addEventListener(e,n,R()?p({capture:!1,passive:!0,once:!1},i):i.capture)}function E(t,e,n,i){i=3<arguments.length&&void 0!==i?i:{capture:!1};t.removeEventListener(e,n,i.capture)}function S(t,e){return t+e}function O(t){return{x:t.map(function(t){return t.x}).reduce(S)/t.length,y:t.map(function(t){return t.y}).reduce(S)/t.length}}function T(t,e,n){var i=e[(n=n||["x","y"])[0]]-t[n[0]],n=e[n[1]]-t[n[1]];return g.sqrt(i*i+n*n)}function D(t,e,n){var i=e.x-t.x,o=e.y-t.y,e=1-n/t.scale;return{x:t.x+i*e,y:t.y+o*e,scale:n}}function B(n,i,t){var o=2<arguments.length&&void 0!==t&&t;_(document,"mousemove",n,{passive:!1,capture:o}),_(document,"mouseup",function t(e){i(e),E(document,"mousemove",n,{capture:o}),E(document,"mouseup",t,{capture:o})},{capture:o})}function L(t){return t.touches||[t]}function H(t){var e,n,i;t.canvas=(e=t.options.width,n=t.options.height,(i=document.createElement("canvas")).width=e,i.height=n,i.style.cssText="width:100%;height:100%;",i),t.context=t.canvas.getContext("2d"),t.renderAction=function(){t.bindEvent(),t.render(),t.renderAction=f}}var I={bindEvent:function(){var e=this,n=e.options.touchTarget||e.canvas;e.eventList.forEach(function(t){_(n,t,e[t]=e[t].bind(e),{passive:!1})})},removeEvent:function(){var e=this,n=e.options.touchTarget||e.canvas;e.eventList.forEach(function(t){n.removeEventListener(t,e[t])})},mousewheel:function(t){t.preventDefault();var e=t.deltaY,e=g.pow(.99,e);this.mousescroll(t,e)},mousescroll:function(t,e){var n=this,i=n.options,o=i.maxScale,i=i.minScale,e=n.position.scale*e;n.rect||(n.rect=n.canvas.getBoundingClientRect()),n.last.point={x:(t.clientX-n.rect.left)*n.canvasRatio,y:(t.clientY-n.rect.top)*n.canvasRatio},o<e?e=o:e<i&&(e=i),n.position.scale!==e&&n.scaleTo(n.last.point,e),clearTimeout(n.mouseScrollTimer),n.mouseScrollTimer=setTimeout(function(){n.validation(null,!0)},100),n.emit("mousewheel",t)},mousedown:function(t){t.preventDefault();this.touchstart(t),B(this.touchmove,this.touchend)},touchstart:function(t){t.preventDefault();var e=L(t);this.moved=!1,this.animation.stop(),2===e.length?this.pinchstart(t):1===e.length&&this.dragstart(t)},touchmove:function(t){t.preventDefault();var e=L(t);this.moved=!0,2===e.length?this.pinchmove(t):1===e.length&&this.dragmove(t)},touchend:function(t){var e=this,n=t.touches||[],i=Date.now();e.moved||i-e.upTime<=300&&e.dobuleClick(),e.upTime=i,n.length?(e.emit("pinchend",t),e.dragstart(t)):e.dragend(t)},dragstart:function(t){var e=this,n=L(t);e.last.move={x:n[0].clientX,y:n[0].clientY},e.last.dis={time:0,x:0,y:0},e.last.time=Date.now(),e.touchDelay=3,e.emit("dragstart",t)},dragmove:function(t){var e=this,n=L(t),i={x:n[0].clientX,y:n[0].clientY},o=(i.x-e.last.move.x)*e.canvasRatio,a=(i.y-e.last.move.y)*e.canvasRatio,n=Date.now();e.last.dis={x:o,y:a,time:n-e.last.time},e.last.time=n,e.last.move=i,e.touchDelay?e.touchDelay--:(e.moveTo(e.position.x+o,e.position.y+a),e.emit("dragmove",t))},dragend:function(t){var e,n,i,o,a,r,s=this;s.moved&&(e=(r=s.position).scale,(n=function(t,e,n){if(t/=n,n=e/n,.3<g.abs(t)||.3<g.abs(n))return{x:t*=420,y:n*=420,time:840}}(s.last.dis.x,s.last.dis.y,s.last.dis.time))?(i=r.x+n.x,o=r.y+n.y,a="easeOutCubic",(r=s.validation({x:i,y:o,scale:e})).isDraw&&(i=r.x,o=r.y,e=r.scale,a="easeOutBack"),s.animate(i,o,e,{type:a,time:n.time})):s.validation(null,!0),s.emit("dragend",t))},pinchstart:function(t){var e=this,n=b(L(t)).map(function(t){return{x:t.clientX,y:t.clientY}}),i=O(n);e.rect=e.canvas.getBoundingClientRect(),e.last.zoom=n,e.last.point={x:(i.x-e.rect.left)*e.canvasRatio,y:(i.y-e.rect.top)*e.canvasRatio},e.touchDelay=5,e.emit("pinchstart",t)},pinchmove:function(t){var e,n=this,i=b(L(t)).map(function(t){return{x:t.clientX,y:t.clientY}}),o=O(i),a={x:(o.x-n.rect.left)*n.canvasRatio,y:(o.y-n.rect.top)*n.canvasRatio},r=a.x-n.last.point.x,s=a.y-n.last.point.y,e=(e=n.last.zoom,T((o=i)[0],o[1])/T(e[0],e[1]));n.last.zoom=i,n.last.point=a,n.touchDelay?n.touchDelay--:(n.position.x+=r,n.position.y+=s,n.scaleTo(a,n.position.scale*e),n.emit("pinchmove",t))},dobuleClick:function(){var t=this,e=t.canvas.getBoundingClientRect(),n=t.options,i=n.maxScale,o=n.minScale,n={x:(t.last.move.x-e.left)*t.canvasRatio,y:(t.last.move.y-e.top)*t.canvasRatio},e=t.position.scale;t.scaleTo(n,e<i?i:o,!0,!0)}},U={easeOutStrong:function(t,e,n,i){return-n*((t=t/i-1)*t*t*t-1)+e},easeOutCubic:function(t,e,n,i){return n*((t=t/i-1)*t*t+1)+e},easeOutBack:function(t,e,n,i,o){return void 0===o&&(o=1.70158),n*((t=t/i-1)*t*((o+1)*t+o)+1)+e}};!function(){for(var o=0,t=["ms","moz","webkit","o"],e=0;e<t.length&&!d.requestAnimationFrame;++e)d.requestAnimationFrame=d[t[e]+"RequestAnimationFrame"],d.cancelAnimationFrame=d[t[e]+"CancelAnimationFrame"]||d[t[e]+"CancelRequestAnimationFrame"];d.requestAnimationFrame||(d.requestAnimationFrame=function(t){var e=Date.now(),n=g.max(0,16-(e-o)),i=d.setTimeout(function(){t(e+n)},n);return o=e+n,i}),d.cancelAnimationFrame||(d.cancelAnimationFrame=function(t){clearTimeout(t)})}();function j(){return Date.now()}var F={time:500,type:"easeOutQuad"};function P(t){var o=null,t=v({},F,t),a=t.time,r=t.type,s=t.targets,c=t.running,l=t.end,u=j();return o=d.requestAnimationFrame(function t(){var e=j(),n=1-(g.max(0,u-e+a)/a||0),i=[];s.forEach(function(t){t=t[0]===t[1]?t[0]:U[r](n*a,t[0],t[1]-t[0],a)||0,i.push(t)}),c(i),1==n?(d.cancelAnimationFrame(o),l&&l()):o=d.requestAnimationFrame(t)}),{stop:function(){d.cancelAnimationFrame(o)}}}var q=d.URL&&d.URL.createObjectURL?d.URL:d.webkitURL&&d.webkitURL.createObjectURL?d.webkitURL:null;function z(e){for(var n,t=0<=e.split(",")[0].indexOf("base64")?d.atob(e.split(",")[1]):unescape(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(t.length),a=new Uint8Array(o),r=0;r<t.length;r++)a[r]=t.charCodeAt(r);try{n=new d.Blob([o],{type:i})}catch(t){d.BlobBuilder=d.BlobBuilder||d.WebKitBlobBuilder||d.MozBlobBuilder||d.MSBlobBuilder,"TypeError"===t.name&&d.BlobBuilder?((e=new d.BlobBuilder).append(a.buffer),n=e.getBlob(i)):"InvalidStateError"===t.name&&(n=new d.Blob([o],{type:i}))}return n}function W(t,e,n){var i=new d.XMLHttpRequest;i.onload=function(){200===this.status||0===this.status?e(i.response):n&&n("Could not load image："+t),i=null},i.open("GET",t,!0),i.responseType="arraybuffer",i.send(null)}function N(t,e,n){var i=new d.FileReader;i.onload=function(t){e(t.target.result)},i.onerror=n||function(t){console.error("fileToArrayBuffer error: ",t)},i.readAsArrayBuffer(t)}function M(t,e,n,i){var o=t.naturalWidth,a=t.naturalHeight;if(o+a){var r=n.width,n=n.height,s=e.getContext("2d");s.save(),function(t){var e=t.naturalWidth,n=t.naturalHeight;{if(1048576<e*n){n=document.createElement("canvas");n.width=n.height=1;n=n.getContext("2d");return n.drawImage(t,1-e,0),0===n.getImageData(0,0,1,1).data[3]}return!1}}(t)&&(o/=2,a/=2);var c=1024,l=document.createElement("canvas");l.width=l.height=c;for(var u=l.getContext("2d"),i=i?function(t,e){var n=document.createElement("canvas");n.width=1,n.height=e;n=n.getContext("2d");n.drawImage(t,0,0);var i=n.getImageData(0,0,1,e).data,o=0,a=e,r=e;for(;o<r;)0===i[4*(r-1)+3]?a=r:o=r,r=a+o>>1;e=r/e;return 0==e?1:e}(t,a):1,d=g.ceil(c*r/o),f=g.ceil(c*n/a/i),h=0,m=0;h<a;){for(var v=0,p=0;v<o;)u.clearRect(0,0,c,c),u.drawImage(t,-v,-h),s.drawImage(l,0,0,c,c,p,m,d,f),v+=c,p+=d;h+=c,m+=f}s.restore(),l=u=null}}function X(t,e,n){var i=new d.Image;return 0<t.indexOf(";base64,")||(i.crossOrigin="*"),i.onload=function(){e(i)},i.onerror=n||function(t){console.error("loadImage error: ",t)},i.src=t,i}var Y={url:{getArrayBuffer:W,toImage:X},file:{getArrayBuffer:N,toImage:function(t,e,n){X(q.createObjectURL(t),e,n)}},objectURL:{getArrayBuffer:function(t,e,n){var i,o;i=t,o=function(t){N(t,e,n)},(t=new d.XMLHttpRequest).open("GET",i,!0),t.responseType="blob",t.onload=function(t){200!==this.status&&0!==this.status||o(this.response)},t.send()},toImage:X},base64:{getArrayBuffer:function(t,e,n){N(z(t),e,n)},toImage:X},imageEl:{getArrayBuffer:function(t,e,n){W(t.src,e,n)},toImage:function(t,e){e(t)}}},G=y.ios?{8:4e6,9:16777216}:null;function V(t,l,e){var u=v({orientation:!0,errorCallback:f},e),n="";if(d.FileReader&&(t instanceof d.Blob||t instanceof d.File))n="file";else if(/^blob:/i.test(t))n="objectURL";else if(t&&t.tagName&&t.nodeType){if("IMG"===t.tagName&&(n="imageEl"),"CANVAS"===t.tagName)return void l(t)}else n="url";function i(t,e,n){var i,o=document.createElement("canvas"),a=e.width,r=e.height,s=o.getContext("2d");function c(t,e){u.orientation?function(t,e,n,i,o){switch(-1<[5,6,7,8].indexOf(o)?(t.width=i,t.height=n):(t.width=n,t.height=i),o){case 2:e.transform(-1,0,0,1,n,0);break;case 3:e.transform(-1,0,0,-1,n,i);break;case 4:e.transform(1,0,0,-1,0,i);break;case 5:e.transform(0,1,1,0,0,0);break;case 6:e.transform(0,1,-1,0,i,0);break;case 7:e.transform(0,-1,-1,0,i,n);break;case 8:e.transform(0,-1,1,0,0,n);break;default:e.transform(1,0,0,1,0,0)}}(o,s,t,e,n):(o.width=t,o.height=e)}G&&G[y.ios.version]&&a*r>G[y.ios.version]?(i=g.sqrt(G[y.ios.version]),c((i=function(t,e){var n=e.maxWidth,i=e.maxHeight,o=e.width,a=e.height,e=t.naturalWidth,t=t.naturalHeight;o&&!a?a=t*o/e<<0:a&&!o?o=e*a/t<<0:(o=e,a=t);n&&n<e&&(a=t*(o=n)/e<<0);i&&i<a&&(o=e*(a=i)/t<<0);return{width:o,height:a}}(e,p({},u,{maxWidth:i,maxHeight:i}))).width,i.height),M(e,o,i,!0)):(c(a,r),s.drawImage(e,0,0)),l(o)}Y[n].toImage(t,function(e){u.orientation?Y[n].getArrayBuffer(t,function(t){t=function(t){var e=new DataView(t);if(65496!==e.getUint16(0,!1))return-2;for(var n=e.byteLength,i=2;i<n;){var o=e.getUint16(i,!1);if(i+=2,65505===o){if(1165519206!==e.getUint32(i+=2,!1))return-1;var a=18761===e.getUint16(i+=6,!1);i+=e.getUint32(i+4,a);var r=e.getUint16(i,a);i+=2;for(var s=0;s<r;s++)if(274===e.getUint16(i+12*s,a))return e.getUint16(i+12*s+8,a)}else{if(65280!=(65280&o))break;i+=e.getUint16(i,!1)}}return-1}(t);i(0,e,t)},u.errorCallback):i(0,e)},u.errorCallback)}function Z(t,e){var n=(o=t,(s=document.createElement("canvas")).width=o.width,s.height=o.height,s.getContext("2d").drawImage(o,0,0),s),i=n.getContext("2d"),t=document.createElement("canvas"),o=t.getContext("2d"),a=n.width,r=n.height,s=g.ceil(a*e),e=g.ceil(r*e);t.width=s,t.height=e;for(var c=g.ceil(g.log(a/s)/g.log(3)),l=0;l<c;l++)i.drawImage(n,0,0,.5*a,.5*r);return o.drawImage(n,0,0,n.width*g.pow(.5,c),n.height*g.pow(.5,c),0,0,s,e),n=i=null,t}var K={load:function(t,e){var n=this;V(t,function(t){n.initImageData(t),n.draw(),n.renderAction(),setTimeout(function(){e&&e(),n.emit("loaded",n)},0)},{errorCallback:function(t){n.emit("error",t)}})},initImageData:function(t){var e,n,i=this,o=i.options,a=o.width,r=o.height,s=o.offset,c=o.maxScale,l={el:t,width:t.width,height:t.height},u=a-(s.left+s.right),d=r-(s.top+s.bottom),o=(n=0,a=-((u=(o=e=u)/(r=(t=l.width)/(a=l.height)))-(d=d))/2,u<d&&(n=-((o=r*(u=d))-e)/2,a=0),{width:o,height:u,x:n,y:a,scale:+(o/t).toFixed(4)});o.x+=s.left,o.y+=s.top;t=g.max(o.scale,c),s=o.scale;i.options.maxScale=t===s?o.scale*g.max(c,1):c,i.options.minScale=s,i.position=o,i.image=l},destroy:function(){this.removeEvent(),x(this.canvas)&&this.options.el.removeChild(this.canvas)},draw:function(){var t=this,e=t.context,n=t.options,i=n.width,o=n.height,a=t.position,r=a.x,s=a.y,c=a.scale;n=t.canvas,a=e,i=i,o=o,y.android&&parseFloat(y.android)<=4.1?n.height=o:a.clearRect(0,0,i,o),e.save(),e.translate(r,s),e.scale(c,c),e.drawImage(t.image.el,0,0),e.restore()},setData:function(t){var e,n,i,o={x:1,y:1,scale:4};for(e in t)this.position[e]=(n=t[e],i=o[e],+n.toFixed(i))},moveTo:function(t,e,n){n?this.animate(t,e,this.position.scale):(this.setData({x:t,y:e}),this.draw())},scaleTo:function(t,e,n,i){var o,a=this;e!==a.position.scale&&(t=(o=D(a.position,t,e)).x,o=o.y,i&&(t=(i=a.checkPosition({x:t,y:o,scale:e})).x,o=i.y),n?a.animate(t,o,e):(a.setData({scale:e}),a.moveTo(t,o)))},animate:function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{time:450,type:"easeOutCubic"},o=this;o.animation.stop(),o.animation=P({targets:[[o.position.scale,n],[o.position.x,t],[o.position.y,e]],time:i.time,type:i.type,running:function(t){o.setData({scale:t[0],x:t[1],y:t[2]}),o.draw()}})}},Q={validation:function(i,t){var e=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],o=this;i=i||o.position;var n=o.options,a=n.maxScale,r=n.minScale,s=i.scale,c={x:i.x,y:i.y,isDraw:!1},n=function(t){var e=D(i,o.last.point,t),n=e.x,e=e.y;(c=o.checkPosition({x:n,y:e,scale:t})).scale=t,c.isDraw=!0};return a<s?n(a):s<r?n(r):(c=o.checkPosition(i)).scale=s,t&&c.isDraw&&(e?o.animate(c.x,c.y,c.scale):(o.setData({x:c.x,y:c.y,scale:c.scale}),o.draw())),c},checkPosition:function(t){var e=t.x,n=t.y,i=t.scale,o=this.options,a=o.width,r=o.height,t=o.offset,o=i*this.image.width,i=i*this.image.height,o=a-(t.left+t.right)-(o-(t.left-e)),r=r-(t.top+t.bottom)-(i-(t.top-n)),i=!1;return n>t.top?(n=t.top,i=!0):0<r&&(n+=r,i=!0),e>t.left?(e=t.left,i=!0):0<o&&(e+=o,i=!0),{x:e,y:n,isDraw:i}}},J=Array.prototype.slice,$=function(){function t(){s(this,t),this.events={}}return e(t,[{key:"on",value:function(t,e,n){var i=this;return t.split(" ").forEach(function(t){i.events[t]||(i.events[t]=[]),e&&i.events[t].push({fn:e,once:n})}),i}},{key:"emit",value:function(t){var o=this,a=J.call(arguments,1);t=t.split(" ").forEach(function(t){var e=o.events[t];if(e)for(var n=e.length,i=0;i<n;i++)e[i]&&(e[i].fn.apply(o,a),e[i].once&&e.splice(i--,1))})}},{key:"off",value:function(t,e){var n=this.events[t];if(n)if(e){for(var i=n.length,o=0;o<i;o++)if(n[o]&&n[o].fn===e){n.splice(o,1);break}}else this.events[t]=[];else t||(this.events={})}}]),t}(),tt=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}(a,$);var o=c(a);function a(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};s(this,a);var n,i=r(t=o.call(this));return e.el&&(e.el="string"==typeof(n=e.el)?document.querySelector(n):n),i.options=v({},a.defaults,e),i.init(),t}return e(a,[{key:"init",value:function(){var t;H(this),(t=this).eventList=["mousewheel","mousedown","touchstart","touchmove","touchend"],t.last={point:{x:0,y:0},move:{x:0,y:0},time:0,dis:{time:0,x:0,y:0}},t.touchDelay=3,t.animation={stop:f},t.wheeling=!1,t.upTime=0,t.touchmove=w(t.touchmove),t.mousescroll=w(t.mousescroll),(t=this).position={x:0,y:0,width:0,height:0,scale:1},t.image={width:0,height:0,el:null}}}]),a}();t(tt,"defaults",{el:document.body,width:2*document.documentElement.clientWidth,height:2*document.documentElement.clientHeight,maxScale:2,touchTarget:null,offset:{left:0,right:0,top:0,bottom:0}}),p(tt.prototype,{render:function(){var t=this,e=t.options,n=e.el,i=e.canvasRatio,e=e.width;n.appendChild(t.canvas),t.rect=t.canvas.getBoundingClientRect(),t.canvasRatio=i||e/t.rect.width}},I,K,Q);var et=document.documentElement.clientWidth,I=document.documentElement.clientHeight,K=.9*g.min(et,I),Q=function(){function r(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};s(this,r);var e=this;e.options=v({},r.defaults,t),e.border=e.options.border,e.elements={},e.isHide=!0,e.init()}return e(r,[{key:"init",value:function(){this.initElement(),this.initCanvas(),this.initEvent()}},{key:"initElement",value:function(){var t,n=this,e=n.options,i=e.viewWidth,o=e.viewHeight,a=document.createElement("div");a.innerHTML=(t=n.options,e=t.cancelText,t=t.confirmText,'<div class="crop" data-el="container"><div class="crop__zoom" data-el="zoom"></div><div class="crop__mask" data-el="mask"></div><div class="crop__handle" data-el="handle">'+'<div class="crop__handle-cancel" data-el="cancel" data-click="onCancel">'.concat(e,"</div>")+'<div class="crop__handle-confirm" data-el="confirm" data-click="onConfirm">'.concat(t,"</div>")+"</div></div>"),b(a.querySelectorAll("*")).forEach(function(t){var e=t.getAttribute("data-el");e&&(n.elements[e]=t)}),k(n.elements.container,{width:i,height:o}),A(n.elements.container,{add:r.CROP_HIDE_CLASS}),n.setBorder(n.border)}},{key:"initCanvas",value:function(){var t=this,e=t.options,n=e.canvasRatio,i=e.maxScale,o=e.viewWidth,e=e.viewHeight,n={maxScale:i,canvasRatio:n,el:t.elements.container,touchTarget:t.elements.zoom,width:o*n,height:e*n,offset:t.canvasOffset};t.canvas=new tt(n)}},{key:"initEvent",value:function(){var t=this;t.onClick=t.onClick.bind(t),t.transitionend=t.transitionend.bind(t),t.canvas.on("loaded",t.render.bind(t),!0),t.canvas.on("loaded",t.show.bind(t)),_(t.elements.container,"click",t.onClick),_(t.elements.container,"transitionend",t.transitionend),_(t.elements.container,"webkitTransitionEnd",t.transitionend)}},{key:"load",value:function(t){this.canvas.load(t)}},{key:"onClick",value:function(t){t=t.target.getAttribute("data-click");t&&this[t]&&this[t]()}},{key:"onCancel",value:function(){this.emit("cancel",this)}},{key:"onConfirm",value:function(){this.emit("confirm",this)}},{key:"transitionend",value:function(t){t=t.target;t===this.elements.container&&this.isHide&&A(t,{add:r.CROP_HIDE_CLASS,remove:this.options.beforeHideClass})}},{key:"render",value:function(){this.options.el.appendChild(this.elements.container)}},{key:"get",value:function(t){var u=this;u.canvas.validation(null,!0,!1);var e=u.options.canvasRatio,n=u.canvas.position,i=n.scale,o=n.x,n=n.y,d=u.border.width*e/i,f=u.border.height*e/i,h=(u.border.x*e-o)/i;h<0&&(h=0);var m=(u.border.y*e-n)/i;m<0&&(m=0);var n=(t=p({width:d,height:f,type:"image/jpeg",format:"base64",quality:.85},t||{})).width/d,i=function(t,e){return n=u.canvas.image.el,i=h,o=m,a=d,r=f,c=s=0,l=t,t=e,e=document.createElement("canvas"),l=e.width=g.floor(l),t=e.height=g.floor(t),e.getContext("2d").drawImage(n,g.floor(i),g.floor(o),g.floor(a),g.floor(r),g.floor(s),g.floor(c),l,t),e;var n,i,o,a,r,s,c,l},a=3<=g.ceil(g.log(d/(d*n))/g.log(3))?Z(i(d,f),n):i(t.width,g.round(f*n)),r={base64:function(){return a.toDataURL(t.type,t.quality)},file:function(){return z(r.base64())},objectUrl:function(){return q.createObjectURL(r.file())},canvas:function(){return a}};if(r[t.format])return r[t.format]();throw new Error("Undefined format: ".concat(t.format,", Try: base64|file|objectUrl|canvas"))}},{key:"setBorder",value:function(t){var e=this,n=e.checkBorder(t),i=n.x,o=n.y,a=n.width,r=n.height,s=e.options,c=s.canvasRatio,l=s.viewWidth,n=s.viewHeight,s=s.circle,s={width:a,height:r,left:i-l,top:o-n,borderWidth:"".concat(n,"px ").concat(l,"px"),borderRadius:!s||y.android&&parseFloat(y.android)<=4.1?null:"50%"},c={left:i*c,top:o*c,right:(l-a-i)*c,bottom:(n-r-o)*c};e.canvas&&(e.canvas.options.offset=c),k(e.elements.mask,s),e.border=t,e.canvasOffset=c}},{key:"checkBorder",value:function(t){var e=t.x,n=t.y,i=t.width,o=t.height,a=this.options,r=a.viewWidth,a=a.viewHeight;return t.width=h(i)?i:r,t.height=h(o)?o:a,t.x=h(e)?e:(r-t.width)/2,t.y=h(n)?n:(a-t.height)/2,t}},{key:"on",value:function(){return this.canvas.on.apply(this.canvas,arguments)}},{key:"emit",value:function(){this.canvas.emit.apply(this.canvas,arguments)}},{key:"off",value:function(){this.canvas.off.apply(this.canvas,arguments)}},{key:"show",value:function(n){var i=this;i.isHide&&d.requestAnimationFrame(function(){var t=i.elements.container,e=i.options;!1===n?A(t,{remove:r.CROP_HIDE_CLASS}):(A(t,{remove:r.CROP_HIDE_CLASS,add:e.beforeShowClass}),d.requestAnimationFrame(function(){A(t,{remove:e.beforeShowClass})})),i.isHide=!1})}},{key:"hide",value:function(e){var n=this;n.isHide||d.requestAnimationFrame(function(){var t=n.elements.container;A(t,!1===e?{add:r.CROP_HIDE_CLASS}:{add:n.options.beforeHideClass}),n.isHide=!0})}},{key:"destroy",value:function(){var t=this,e=t.elements.container;t.canvas.destroy(),E(e,"click",t.onClick),E(e,"transitionend",t.transitionend),E(e,"webkitTransitionEnd",t.transitionend),x(e)&&t.options.el.removeChild(e)}}]),r}();return t(Q,"defaults",{viewWidth:et,viewHeight:I,el:document.body,border:{width:K,height:K},circle:!1,maxScale:2,canvasRatio:2,confirmText:"确认",cancelText:"取消",beforeShowClass:"crop_slide-to-right",beforeHideClass:"crop_slide-to-bottom"}),t(Q,"imageToCanvas",V),t(Q,"Canvas",tt),t(Q,"CROP_HIDE_CLASS","crop_hide"),Q});
