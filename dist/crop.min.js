/*!
   * @name xcrop v1.0.3
   * @github https://github.com/ffx0s/xcrop
   * @license MIT.
   */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Crop=e()}(this,function(){"use strict";function t(t){return'<div class="crop-container crop-hide" data-el="container"><div class="crop-mask" data-el="mask"></div><div class="crop-handle" data-el="handle"><div class="crop-cancle" data-el="cancle" data-event="onCancle">'+t.cancleText+'</div><div class="crop-confirm" data-el="confirm" data-event="onConfirm">'+t.confirmText+"</div></div></div>"}function e(){}function n(t){return"[object Object]"===P.call(t)}function i(t){return n(t)||Array.isArray(t)}function o(t){return"string"==typeof t}function r(t){return"number"==typeof t&&t!==1/0&&!isNaN(t)}function a(t){return function(e){if(null!==e&&void 0!==e){for(var n=arguments,i=n.length,o=1;o<i;o++)!function(i){var o=n[i];if(null===o||void 0===o)return!1;Object.keys(o).forEach(function(n){t(e,o,n)})}(o);return e}}}function c(t,e){setTimeout(t,e||0)}function s(t){return M.call(t)}function l(t){return t.charAt(0).toUpperCase()+t.slice(1)}function u(t,e){return t+e}function f(t){return{x:t.map(function(t){return t.x}).reduce(u)/t.length,y:t.map(function(t){return t.y}).reduce(u)/t.length}}function h(t,e,n){n=n||["x","y"];var i=e[n[0]]-t[n[0]],o=e[n[1]]-t[n[1]];return z.sqrt(i*i+o*o)}function d(t,e){return h(e[0],e[1])/h(t[0],t[1])}function p(t,e,n,i,o){var r=n.x-t.x,a=n.y-t.y,c=t.x+r*(1-o),s=t.y+a*(1-o),l=c-e.x,u=s-e.y;return{scale:i*o,x:e.x+l,y:e.y+u}}function v(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n.style.cssText="width:100%;height:100%;",n}function m(t,e){return+t.toFixed(e)}function g(t){t.canvas=v(t.options.width,t.options.height),t.context=t.canvas.getContext("2d"),t.renderAction=function(){t.bindEvent(),t.render(),t.renderAction=e}}function y(t){t.eventList=["mousewheel","touchstart","touchmove","touchend"],t.last={point:{x:0,y:0},move:{x:0,y:0},time:0,dis:{time:0,x:0,y:0}},t.touchDelay=3,t.animation={stop:e},t.wheeling=!1}function w(t){var e=void 0;e=t.split(",")[0].indexOf("base64")>=0?q.atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var n=t.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(e.length),o=new Uint8Array(i),r=0;r<e.length;r++)o[r]=e.charCodeAt(r);var a=void 0;try{a=new q.Blob([i],{type:n})}catch(t){if(q.BlobBuilder=q.BlobBuilder||q.WebKitBlobBuilder||q.MozBlobBuilder||q.MSBlobBuilder,"TypeError"===t.name&&q.BlobBuilder){var c=new q.BlobBuilder;c.append(o.buffer),a=c.getBlob(n)}else"InvalidStateError"===t.name&&(a=new q.Blob([i],{type:n}))}return a}function b(t,e){var n=new q.XMLHttpRequest;n.open("GET",t,!0),n.responseType="blob",n.onload=function(t){200!==this.status&&0!==this.status||e(this.response)},n.send()}function x(t,e,n){var i=new q.XMLHttpRequest;i.onload=function(){200===this.status||0===this.status?e(i.response):n&&n("Could not load image："+t),i=null},i.open("GET",t,!0),i.responseType="arraybuffer",i.send(null)}function k(t,e,n){var i=new q.FileReader;i.onload=function(t){e(t.target.result)},i.onerror=n||function(t){console.error("fileToArrayBuffer error: ",t)},i.readAsArrayBuffer(t)}function C(t){var e=new DataView(t);if(65496!==e.getUint16(0,!1))return-2;for(var n=e.byteLength,i=2;i<n;){var o=e.getUint16(i,!1);if(i+=2,65505===o){if(1165519206!==e.getUint32(i+=2,!1))return-1;var r=18761===e.getUint16(i+=6,!1);i+=e.getUint32(i+4,r);var a=e.getUint16(i,r);i+=2;for(var c=0;c<a;c++)if(274===e.getUint16(i+12*c,r))return e.getUint16(i+12*c+8,r)}else{if(65280!=(65280&o))break;i+=e.getUint16(i,!1)}}return-1}function E(t,e,n,i){var o=t.naturalWidth,r=t.naturalHeight;if(o+r){var a=n.width,c=n.height,s=e.getContext("2d");s.save();O(t)&&(o/=2,r/=2);var l=1024,u=document.createElement("canvas");u.width=u.height=l;for(var f=u.getContext("2d"),h=i?B(t,o,r):1,d=z.ceil(l*a/o),p=z.ceil(l*c/r/h),v=0,m=0;v<r;){for(var g=0,y=0;g<o;)f.clearRect(0,0,l,l),f.drawImage(t,-g,-v),s.drawImage(u,0,0,l,l,y,m,d,p),g+=l,y+=d;v+=l,m+=p}s.restore(),u=f=null}}function O(t){var e=t.naturalWidth;if(e*t.naturalHeight>1048576){var n=document.createElement("canvas");n.width=n.height=1;var i=n.getContext("2d");return i.drawImage(t,1-e,0),0===i.getImageData(0,0,1,1).data[3]}return!1}function B(t,e,n){var i=document.createElement("canvas");i.width=1,i.height=n;var o=i.getContext("2d");o.drawImage(t,0,0);for(var r=o.getImageData(0,0,1,n).data,a=0,c=n,s=n;s>a;){0===r[4*(s-1)+3]?c=s:a=s,s=c+a>>1}var l=s/n;return 0===l?1:l}function R(t,e,n,i,o){switch([5,6,7,8].indexOf(o)>-1?(t.width=i,t.height=n):(t.width=n,t.height=i),o){case 2:e.transform(-1,0,0,1,n,0);break;case 3:e.transform(-1,0,0,-1,n,i);break;case 4:e.transform(1,0,0,-1,0,i);break;case 5:e.transform(0,1,1,0,0,0);break;case 6:e.transform(0,1,-1,0,i,0);break;case 7:e.transform(0,-1,-1,0,i,n);break;case 8:e.transform(0,-1,1,0,0,n);break;default:e.transform(1,0,0,1,0,0)}}function T(t,e,n,i){var o=t/e,r=n,a=r/o,c=0,s=-(a-i)/2;return a<i&&(a=i,r=o*a,c=-(r-n)/2,s=0),{width:r,height:a,x:c,y:s,scale:+(r/t).toFixed(4)}}function A(t,e,n){var i=new q.Image;return ot(t)||(i.crossOrigin="*"),i.onload=function(){e(i)},i.onerror=n||function(t){console.error("loadImage error: ",t)},i.src=t,i}function D(t,n,i){function o(t,e,i){function o(t,e){r.orientation?R(a,l,t,e,i):(a.width=t,a.height=e)}var a=document.createElement("canvas"),c=e.width,s=e.height,l=a.getContext("2d");if(at&&at[Z.ios.version]&&c*s>at[Z.ios.version]){var u=z.sqrt(at[Z.ios.version]),f=U(e,Y({},r,{maxWidth:u,maxHeight:u}));o(f.width,f.height),E(e,a,f,!0)}else o(c,s),l.drawImage(e,0,0);n(a)}var r=X({orientation:!0,errorCallback:e},i),a="";if(q.FileReader&&(t instanceof q.Blob||t instanceof q.File))a="file";else if(it(t))a="objectURL";else if(t&&t.tagName&&t.nodeType){if("IMG"===t.tagName&&(a="imageEl"),"CANVAS"===t.tagName)return void n(t)}else a="url";rt[a].toImage(t,function(e){r.orientation?rt[a].getArrayBuffer(t,function(n){var i=C(n);o(t,e,i)},r.errorCallback):o(t,e)},r.errorCallback)}function U(t,e){var n=e.maxWidth,i=e.maxHeight,o=e.width,r=e.height,a=t.naturalWidth,c=t.naturalHeight;return o&&!r?r=c*o/a<<0:r&&!o?o=a*r/c<<0:(o=a,r=c),n&&a>n&&(o=n,r=c*o/a<<0),i&&r>i&&(r=i,o=a*r/c<<0),{width:o,height:r}}function j(t){return o(t)?document.querySelector(t):t}function I(t){return document.body.contains(t)}function L(t,e){for(var n in e){var i=r(e[n])?e[n]+"px":e[n];-1!==["transform","transformOrigin","transition"].indexOf(n)?t.style["Webkit"+l(n)]=t.style[n]=i:t.style[n]=i}}function S(t){t.firstOrigin={x:0,y:0},t.position={x:0,y:0,width:0,height:0,scale:1},t.image={width:0,height:0,el:null}}function _(t){var e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),e}function H(t,e){var n=_(t),i=n.getContext("2d"),o=document.createElement("canvas"),r=o.getContext("2d"),a=n.width,c=n.height,s=z.ceil(a*e),l=z.ceil(c*e);o.width=s,o.height=l;for(var u=z.ceil(z.log(a/s)/z.log(3)),f=0;f<u;f++)i.drawImage(n,0,0,.5*a,.5*c);return r.drawImage(n,0,0,n.width*z.pow(.5,u),n.height*z.pow(.5,u),0,0,s,l),i=null,n=null,o}function W(t,e,n,i,o,r,a,c,s){var l=document.createElement("canvas"),u=l.width=z.floor(c),f=l.height=z.floor(s);return l.getContext("2d").drawImage(t,z.floor(e),z.floor(n),z.floor(i),z.floor(o),z.floor(r),z.floor(a),u,f),l}var q=window,z=q.Math;!function(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&i.firstChild?i.insertBefore(o,i.firstChild):i.appendChild(o),o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t))}}('.crop-container{position:fixed;left:0;top:0;overflow:hidden;background:#000;z-index:1;-webkit-transition:transform .3s;transition:transform .3s;-webkit-transition:-webkit-transform .3s}.crop-container.crop-hide{display:none}.crop-container.crop-slide-left{-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0)}.crop-container.crop-slide-right{-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}.crop-container.crop-slide-top{-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}.crop-container.crop-slide-bottom{-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0)}.crop-mask{position:absolute;overflow:hidden;border:1px solid rgba(0,0,0,.6);-webkit-transform:translateZ(0);transform:translateZ(0);-webkit-box-sizing:content-box;box-sizing:content-box}.crop-mask:before{position:absolute;left:0;top:0;float:left;content:"";width:200%;height:200%;border:1px solid #fff;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-transform:scale(.5);transform:scale(.5);-webkit-transform-origin:0 0;transform-origin:0 0}.crop-handle{position:absolute;bottom:0;left:0;width:100%;height:50px;line-height:50px;-webkit-transform:translateZ(0);transform:translateZ(0)}.crop-handle div{height:100px;width:80px;color:#fff;font-size:16px;text-align:center}.crop-cancle{float:left}.crop-confirm{float:right}');var F=document.documentElement.clientWidth,N=document.documentElement.clientHeight,P=Object.prototype.toString,M=Array.prototype.slice,X=a(function(t,e,o){var r=e[o];i(r)?(t[o]=n(r)?{}:[],X(t[o],r)):t[o]=r}),Y=Object.assign||a(function(t,e,n){var i=e[n];t[n]=i}),Z=function(){var t=navigator.userAgent;return{ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&{version:+t.match(/[OS\s]\d+/i)[0]}}}(),G={render:function(){var t=this,e=t.options,n=e.el,i=e.canvasRatio,o=e.width;n.appendChild(t.canvas),t.rect=t.canvas.getBoundingClientRect(),t.canvasRatio=i||o/t.rect.width}},V={easeOutStrong:function(t,e,n,i){return-n*((t=t/i-1)*t*t*t-1)+e},easeOutCubic:function(t,e,n,i){return n*((t=t/i-1)*t*t+1)+e}},K=q.requestAnimationFrame||q.webkitRequestAnimationFrame||function(t){return q.setTimeout(t,1e3/60)},Q=q.cancelAnimationFrame||function(t){clearTimeout(t)},J=function(){return(new Date).getTime()},$={time:500,type:"easeOutQuad"},tt=function(t){function e(){var t=J(),i=1-(z.max(0,l-t+o)/o||0),u=[];a.forEach(function(t){var e=t[0]===t[1]?t[0]:V[r](i*o,t[0],t[1]-t[0],o)||0;u.push(e)}),c(u),1===i?(Q(n),s&&s()):n=K(e)}var n=null,i=X({},$,t),o=i.time,r=i.type,a=i.targets,c=i.running,s=i.end,l=J();return n=K(e),{stop:function(){Q(n)}}},et={bindEvent:function(){var t=this,e=t.options.touchTarget||t.canvas;t.eventList.forEach(function(n){e.addEventListener(n,t[n]=t[n].bind(t))})},removeEvent:function(){var t=this,e=t.options.touchTarget||t.canvas;t.eventList.forEach(function(n){e.removeEventListener(n,t[n])})},mousewheel:function(t){t.preventDefault();var e=this;if(!e.wheeling){c(function(){e.wheeling=!1},30),e.wheeling=!0;var n=t.deltaY,i=z.pow(.99,n);e.rect=e.canvas.getBoundingClientRect(),e.last.point={x:(t.clientX-e.rect.left)*e.canvasRatio,y:(t.clientY-e.rect.top)*e.canvasRatio},e.scaleTo(e.last.point,e.position.scale*i),e.emit("mousewheel",t)}},touchstart:function(t){t.preventDefault();var e=this,n=t.touches;e.animation.stop(),2===n.length?e.pinchstart(t):1===n.length&&e.dragstart(t)},touchmove:function(t){var e=this,n=t.touches;2===n.length?e.pinchmove(t):1===n.length&&e.dragmove(t)},touchend:function(t){var e=this;t.touches.length?(e.emit("pinchend",t),e.dragstart(t)):e.dragend(t)},dragstart:function(t){var e=this,n=t.touches;e.last.move={x:n[0].clientX,y:n[0].clientY},e.last.dis={time:0,x:0,y:0},e.last.time=(new Date).getTime(),e.touchDelay=3,e.emit("dragstart",t)},dragmove:function(t){var e=this,n=t.touches,i={x:n[0].clientX,y:n[0].clientY},o=(i.x-e.last.move.x)*e.canvasRatio,r=(i.y-e.last.move.y)*e.canvasRatio,a=(new Date).getTime();if(e.last.dis={x:o,y:r,time:a-e.last.time},e.last.time=a,e.last.move=i,e.touchDelay)return void e.touchDelay--;e.moveTo(e.position.x+o,e.position.y+r),e.emit("dragmove",t)},dragend:function(t){var e=this;if(!e.validation()){var n=e.position,i=e.last.dis.x/e.last.dis.time,o=e.last.dis.y/e.last.dis.time;if(z.abs(i)>.4||z.abs(o)>.4){var r=n.x+300*i,a=n.y+300*o,c=e.checkBorder({x:r,y:a},n.scale,{x:r,y:a}),s=c.isDraw,l=c.xpos,u=c.ypos;s&&(r=l+8*i,a=u+8*o),e.animation=tt({time:600,targets:[[n.x,r],[n.y,a]],type:"easeOutCubic",running:function(t){e.setData({x:t[0],y:t[1]}),e.draw()},end:function(){e.validation()}})}}e.emit("dragend",t)},pinchstart:function(t){var e=this,n=s(t.touches).map(function(t){return{x:t.clientX,y:t.clientY}}),i=f(n);e.rect=e.canvas.getBoundingClientRect(),e.last.point=n,e.last.point={x:(i.x-e.rect.left)*e.canvasRatio,y:(i.y-e.rect.top)*e.canvasRatio},e.touchDelay=5,e.emit("pinchstart",t)},pinchmove:function(t){var e=this,n=s(t.touches).map(function(t){return{x:t.clientX,y:t.clientY}}),i=f(n),o={x:(i.x-e.rect.left)*e.canvasRatio,y:(i.y-e.rect.top)*e.canvasRatio},r=o.x-e.last.point.x,a=o.y-e.last.point.y,c=d(e.last.point,n);if(e.last.point=n,e.last.point=o,e.touchDelay)return void e.touchDelay--;e.position.x+=r,e.position.y+=a,e.scaleTo(o,e.position.scale*c),e.emit("pinchmove",t)}},nt=q.URL&&q.URL.createObjectURL?q.URL:q.webkitURL&&q.webkitURL.createObjectURL?q.webkitURL:null,it=function(t){return/^blob:/i.test(t)},ot=function(t){return t.indexOf(";base64,")>0},rt={url:{getArrayBuffer:x,toImage:A},file:{getArrayBuffer:k,toImage:function(t,e,n){A(nt.createObjectURL(t),e,n)}},objectURL:{getArrayBuffer:function(t,e,n){b(t,function(t){k(t,e,n)})},toImage:A},base64:{getArrayBuffer:function(t,e,n){k(w(t),e,n)},toImage:A},imageEl:{getArrayBuffer:function(t,e,n){x(t.src,e,n)},toImage:function(t,e){e(t)}}},at=function(){return Z.ios?{8:4e6,9:16777216}:null}(),ct=/\S+/g,st=function(){function t(t,e){return e=Array.isArray(e)?e.join(" "):e.match(ct).join(" "),""===t?e:t+" "+e}function e(t,e){return(Array.isArray(e)?e:e.match(ct)).forEach(function(e){t=t.replace(new RegExp(""+e,"g"),"")}),t.trim()}return function(n,i){var o=n.className;i.remove&&(o=e(o,i.remove)),i.add&&(o=t(o,i.add)),n.className=o}}(),lt={load:function(t,e){var n=this;D(t,function(t){n.initImageData(t),n.draw(),n.renderAction(),c(function(){e&&e(),n.emit("loaded",n)})},{errorCallback:function(t){n.emit("error",t)}})},initImageData:function(t){var e=this,n=e.options,i=n.width,o=n.height,r=n.offset,a=n.maxScale,c={el:t,width:t.width,height:t.height},s=i-(r.left+r.right),l=o-(r.top+r.bottom),u=T(c.width,c.height,s,l);u.x+=r.left,u.y+=r.top;var f=z.max(u.scale,a),h=u.scale;e.options.maxScale=f===h?u.scale*z.max(a,1):a,e.options.minScale=h,e.firstOrigin={x:u.x,y:u.y},e.position=u,e.image=c},destroy:function(){var t=this;t.removeEvent(),I(t.canvas)&&t.options.el.removeChild(t.canvas)},draw:function(){var t=this,e=t.context,n=t.options,i=n.width,o=n.height,r=t.position,a=r.x,c=r.y,s=r.scale;e.clearRect(0,0,i,o),e.save(),t.context.translate(a,c),e.scale(s,s),e.drawImage(t.image.el,0,0),e.restore()},setData:function(t){var e=this,n={x:1,y:1,scale:4};for(var i in t)e.position[i]=m(t[i],n[i])},moveTo:function(t,e,n){var i=this;n?i.animate(i.position.scale,t,e):(i.setData({x:t,y:e}),i.draw())},scaleTo:function(t,e){var n=this;if(e!==n.position.scale){var i=e/n.position.scale,o=p(n.position,n.firstOrigin,t,e/i,i),r=o.x,a=o.y;n.setData({scale:e}),n.moveTo(r,a)}},animate:function(t,e,n){var i=this;i.animation=tt({targets:[[i.position.scale,t],[i.position.x,e],[i.position.y,n]],time:450,type:"easeOutCubic",running:function(t){i.setData({scale:t[0],x:t[1],y:t[2]}),i.draw()}})}},ut={validation:function(){function t(t){var n=t/e.position.scale,i=p(e.position,e.firstOrigin,e.last.point,r,n),o=i.x,c=i.y;r=t,a=e.checkBorder({x:o,y:c},t,{x:o,y:c}),a.isDraw=!0}var e=this,n=e.options,i=n.maxScale,o=n.minScale,r=e.position.scale,a={xpos:e.position.x,ypos:e.position.y,isDraw:!1};return r>i?t(i):r<o?t(o):a=e.checkBorder(e.position,r,e.position),a.isDraw&&e.animate(r,a.xpos,a.ypos),a.isDraw},checkBorder:function(t,e,n){var i=this,o=i.options,r=o.width,a=o.height,c=o.offset,s=e*i.image.width,l=e*i.image.height,u=r-(c.left+c.right)-(s-(c.left-n.x)),f=a-(c.top+c.bottom)-(l-(c.top-n.y)),h=t.x,d=t.y,p=!1;return d>c.top?(d=c.top,p=!0):f>0&&(d+=f,p=!0),h>c.left?(h=c.left,p=!0):u>0&&(h+=u,p=!0),{xpos:h,ypos:d,isDraw:p}}},ft=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},ht=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),dt=function t(e,n,i){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,n,i)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(i)},pt=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},vt=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},mt=Array.prototype.slice,gt=function(){function t(){ft(this,t),this.events={}}return ht(t,[{key:"on",value:function(t,e){var n=this;return t.split(" ").forEach(function(t){n.events[t]||(n.events[t]=[]),e&&n.events[t].push(e)}),n}},{key:"emit",value:function(t){var e=this,n=mt.call(arguments,1);t=t.split(" ").forEach(function(t){var i=e.events[t];i&&i.forEach(function(t){return t.apply(e,n)})})}},{key:"off",value:function(t,e){var n=this,i=n.events[t];if(i){var o=i.indexOf(e);-1!==o&&i.forEach(function(t){return i.splice(o,1)})}}}]),t}(),yt={el:document.body,width:2*F,height:2*N,maxScale:2,touchTarget:null,offset:{left:0,right:0,top:0,bottom:0}},wt=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ft(this,e);var n=vt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),i=n;return t.el&&(t.el=j(t.el)),i.options=X({},yt,t),n}return pt(e,t),ht(e,[{key:"init",value:function(){var t=this;g(t),y(t),S(t)}}]),e}(gt);Y(wt.prototype,G,et,lt,ut);var bt={element:document.body,viewWidth:F,viewHeight:N,maxScale:2,canvasRatio:2,confirmText:"确认",cancleText:"取消",showClass:"crop-slide-left",hideClass:"crop-slide-bottom"},xt=function(e){function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ft(this,n);var e=vt(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,X({},bt,t))),i=e,o=.8*z.min(i.options.viewWidth,i.options.viewHeight);return i.border={x:(i.options.viewWidth-o)/2,y:(i.options.viewHeight-o)/2,width:o,height:o},i.elements={},i.init(),e}return pt(n,e),ht(n,[{key:"init",value:function(){dt(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"init",this).call(this),this.initElement(),this.initEvent()}},{key:"initElement",value:function(){var e=this,n=e.options,i=n.showClass,o=n.viewWidth,r=n.viewHeight,a=document.createElement("div");a.innerHTML=t(e.options),s(a.querySelectorAll("*")).forEach(function(t){var n=t.getAttribute("data-el");n&&(e.elements[n]=t)}),L(e.elements.container,{width:o,height:r}),st(e.elements.container,{add:i}),e.setBorder(e.border)}},{key:"initEvent",value:function(){var t=this,e=function e(){t.render(),t.that.off("loaded",e)};t.that.on("loaded",t.show.bind(t)),t.that.on("loaded",e),t.elements.container.addEventListener("touchstart",t)}},{key:"handleEvent",value:function(t){var e=t.target.getAttribute("data-event");if(e)switch(t.type){case"touchstart":this[e]()}}},{key:"onCancle",value:function(){this.emit("cancle",this)}},{key:"onConfirm",value:function(){this.emit("confirm",this)}},{key:"render",value:function(){this.options.element.appendChild(this.elements.container)}},{key:"get",value:function(t){var e=this,n=e.options.canvasRatio,i=e.that.position,o=i.scale,r=i.x,a=i.y,c=e.border.width*n/o,s=e.border.height*n/o,l=(e.border.x*n-r)/o,u=(e.border.y*n-a)/o,f=void 0;t=Y({width:c,height:s,type:"image/jpeg",format:"base64",quality:.85},t||{});var h=t.width/c,d=z.ceil(z.log(c/(c*h))/z.log(3))>=3,p=function(t,n){return W(e.that.image.el,l,u,c,s,0,0,t,n)};f=d?H(p(c,s),h):p(t.width,z.round(s*(t.width/c)));var v={base64:function(){return f.toDataURL(t.type,t.quality)},file:function(){return w(v.base64())},objectUrl:function(){return nt.createObjectURL(v.file())},canvas:function(){return f}};if(v[t.format])return v[t.format]();throw new Error("Format params error, Try: base64|file|objectUrl|canvas")}},{key:"setBorder",value:function(t){var e=this,n=t.x,i=t.y,o=t.width,r=t.height,a=e.options,c=a.canvasRatio,s=a.viewWidth,l=a.viewHeight,u={width:o,height:r,left:n-s,top:i-l,borderWidth:l+"px "+s+"px"},f={left:n*c,top:i*c,right:(s-o-n)*c,bottom:(l-r-i)*c};e.pinch&&(e.that.options.offset=f),L(e.elements.mask,u),e.border=t,e.pinchOffset=f}},{key:"load",value:function(t){this.that.load(t)}},{key:"on",value:function(){return this.that.on.apply(this.pinch,arguments)}},{key:"off",value:function(){this.that.off.apply(this.pinch,arguments)}},{key:"emit",value:function(){this.that.emit.apply(this.pinch,arguments)}},{key:"show",value:function(t){var e=this,n=this.elements.container,i=!1===t?0:30;c(function(){st(n,{remove:"crop-hide"}),c(function(){st(n,{remove:e.options.showClass})},i)})}},{key:"hide",value:function(t){var e=this,n=e.elements.container,i=!1===t?0:300;c(function(){st(n,{add:e.options.hideClass}),c(function(){st(n,{add:["crop-hide",e.options.showClass],remove:e.options.hideClass})},i)})}},{key:"destroy",value:function(){var t=this,e=t.elements.container;t.that.destroy(),e.removeEventListener("touchstart",t),I(e)&&t.options.element.removeChild(e)}}]),n}(wt);return xt.imageToCanvas=D,xt.Pinch=wt,xt});
